<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fat-Free Framework: /Users/aplennevaux/GITHUB/Visionary-website/src/vendor/bcosca/fatfree/lib/smtp.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fatfreelogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fat-Free Framework
   &#160;<span id="projectnumber">3.6</span>
   </div>
   <div id="projectbrief">A powerful yet easy-to-use PHP micro-framework designed to help you build dynamic and robust web applications - fast!</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_34f9efcbe275e1eae72bb71ece996bfd.html">Visionary-website</a></li><li class="navelem"><a class="el" href="dir_92802f207d92198b044e0274f992e803.html">src</a></li><li class="navelem"><a class="el" href="dir_948941873e3c51b6a030fa75a2e3a2f2.html">vendor</a></li><li class="navelem"><a class="el" href="dir_7f5e6e1d75f51a3f142e3c5e22a4f1f6.html">bcosca</a></li><li class="navelem"><a class="el" href="dir_d0c6e39b4c7f2055afaaffb16f533702.html">fatfree</a></li><li class="navelem"><a class="el" href="dir_84501c881ce5760a3231f0a176c93d92.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">smtp.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="smtp_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">    Copyright (c) 2009-2016 F3::Factory/Bong Cosca, All rights reserved.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">    This file is part of the Fat-Free Framework (http://fatfreeframework.com).</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">    This is free software: you can redistribute it and/or modify it under the</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">    terms of the GNU General Public License as published by the Free Software</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">    Foundation, either version 3 of the License, or later.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">    Fat-Free Framework is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">    General Public License for more details.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">    You should have received a copy of the GNU General Public License along</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">    with Fat-Free Framework.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html">   24</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_s_m_t_p.html">SMTP</a> <span class="keyword">extends</span> <a class="code" href="class_magic.html">Magic</a> {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">const</span></div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#a3ea1a09993798da7eba3b05e89fca4c2">   28</a></span>&#160;        <a class="code" href="class_s_m_t_p.html#a3ea1a09993798da7eba3b05e89fca4c2">E_Header</a>=<span class="stringliteral">&#39;%s: header is required&#39;</span>,</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#ae837eb485f6bf62b8bbe8e9007c04cb2">   29</a></span>&#160;        <a class="code" href="class_s_m_t_p.html#ae837eb485f6bf62b8bbe8e9007c04cb2">E_Blank</a>=<span class="stringliteral">&#39;Message must not be blank&#39;</span>,</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#aedc0129d8cb1011801aee1950c279caf">   30</a></span>&#160;        <a class="code" href="class_s_m_t_p.html#aedc0129d8cb1011801aee1950c279caf">E_Attach</a>=<span class="stringliteral">&#39;Attachment %s not found&#39;</span>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keyword">protected</span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#a598ca4e71b15a1313ec95f0df1027ca5">   35</a></span>&#160;        <a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>,</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <a class="code" href="class_s_m_t_p.html#aa2f80297e973639eba0f2f8619fe783b">$attachments</a>,</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <a class="code" href="class_s_m_t_p.html#a711797613cb863ca0756df789c396bf2">$host</a>,</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <a class="code" href="class_s_m_t_p.html#aa0787efab4b22e8a212882f3409d4c77">$port</a>,</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <a class="code" href="class_s_m_t_p.html#a1665950e3e3b63a02fc5a48706ac81c4">$scheme</a>,</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <a class="code" href="class_s_m_t_p.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <a class="code" href="class_s_m_t_p.html#a4a84bb9d73addd9e90f2f34c36035df4">$pw</a>,</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="class_s_m_t_p.html#a33a9dcf5eaeebf833f2390060f8caf5e">$socket</a>,</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <a class="code" href="class_s_m_t_p.html#a9a2cf15a653aee8be437f7ae474cd494">$log</a>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">   58</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">fixheader</a>($key) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">return</span> str_replace(<span class="charliteral">&#39; &#39;</span>,<span class="charliteral">&#39;-&#39;</span>,</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            ucwords(preg_replace(<span class="stringliteral">&#39;/[_-]/&#39;</span>,<span class="charliteral">&#39; &#39;</span>,strtolower($key))));</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#ace1ae5be37bf26c172cc7ea4e1a65e26">   68</a></span>&#160;    <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#ace1ae5be37bf26c172cc7ea4e1a65e26">exists</a>($key) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        $key=$this-&gt;<a class="code" href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">fixheader</a>($key);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">return</span> isset($this-&gt;headers[$key]);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#ac8d8012023e560c81f55a629022cb65a">   79</a></span>&#160;    <span class="keyword">function</span> <span class="keyword">set</span>($key,$val) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        $key=$this-&gt;<a class="code" href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">fixheader</a>($key);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">return</span> $this-&gt;headers[$key]=$val;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#ac3695923790b06917410e205068b8376">   89</a></span>&#160;    <span class="keyword">function</span> &amp;<span class="keyword">get</span>($key) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        $key=$this-&gt;<a class="code" href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">fixheader</a>($key);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> (isset($this-&gt;headers[$key]))</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            $val=&amp;$this-&gt;headers[$key];</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            $val=NULL;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">return</span> $val;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#a10a949ef75de6c82c98ac555f371ba83">  103</a></span>&#160;    <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#a10a949ef75de6c82c98ac555f371ba83">clear</a>($key) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        $key=$this-&gt;<a class="code" href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">fixheader</a>($key);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        unset($this-&gt;headers[$key]);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#a5e06d9b7f0033278f40a41d081efbe71">  112</a></span>&#160;    <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#a5e06d9b7f0033278f40a41d081efbe71">log</a>() {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">return</span> str_replace(<span class="stringliteral">&quot;\n&quot;</span>,PHP_EOL,$this-&gt;<a class="code" href="class_s_m_t_p.html#a5e06d9b7f0033278f40a41d081efbe71">log</a>);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">  123</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>($cmd=NULL,$log=TRUE,$mock=FALSE) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        $reply=<span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span> ($mock) {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            $host=str_replace(<span class="stringliteral">&#39;ssl://&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$this-&gt;host);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">switch</span> ($cmd) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">case</span> NULL:</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                $reply=<span class="stringliteral">&#39;220 &#39;</span>.$host.<span class="stringliteral">&#39; ESMTP ready&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;DATA&#39;</span>:</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                $reply=<span class="stringliteral">&#39;354 Go ahead&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;QUIT&#39;</span>:</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                $reply=<span class="stringliteral">&#39;221 &#39;</span>.$host.<span class="stringliteral">&#39; closing connection&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                $reply=<span class="stringliteral">&#39;250 OK&#39;</span>.<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            $socket=&amp;<a class="code" href="class_s_m_t_p.html#a33a9dcf5eaeebf833f2390060f8caf5e">$this-&gt;socket</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">if</span> ($cmd)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                fputs($socket,$cmd.<span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">while</span> (!feof($socket) &amp;&amp; ($info=stream_get_meta_data($socket)) &amp;&amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                !$info[<span class="stringliteral">&#39;timed_out&#39;</span>] &amp;&amp; $str=fgets($socket,4096)) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                $reply.=$str;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/(?:^|\n)\d{3} .+?\r\n/s&#39;</span>,$reply))</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> ($log) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">if</span> ($cmd)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                $this-&gt;<a class="code" href="class_s_m_t_p.html#a5e06d9b7f0033278f40a41d081efbe71">log</a>.=$cmd.<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#a5e06d9b7f0033278f40a41d081efbe71">log</a>.=str_replace(<span class="stringliteral">&quot;\r&quot;</span>,<span class="stringliteral">&#39;&#39;</span>,$reply);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">return</span> $reply;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#acddb7c5e0234289640206f7ee89c14e5">  168</a></span>&#160;    <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#acddb7c5e0234289640206f7ee89c14e5">attach</a>($file,$alias=NULL,$cid=NULL) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">if</span> (!is_file($file))</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            user_error(sprintf(self::E_Attach,$file),E_USER_ERROR);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">if</span> ($alias)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            $file=[$alias=&gt;$file];</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        $this-&gt;attachments[]=[<span class="stringliteral">&#39;filename&#39;</span>=&gt;$file,<span class="stringliteral">&#39;cid&#39;</span>=&gt;$cid];</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#acf11a2bd1ca8c23866ccadfbe1e0954d">  183</a></span>&#160;    <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#acf11a2bd1ca8c23866ccadfbe1e0954d">send</a>($message,$log=TRUE,$mock=FALSE) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;scheme==<span class="stringliteral">&#39;ssl&#39;</span> &amp;&amp; !extension_loaded(<span class="stringliteral">&#39;openssl&#39;</span>))</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordflow">return</span> FALSE;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// Message should not be blank</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">if</span> (!$message)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            user_error(self::E_Blank,E_USER_ERROR);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        $fw=<a class="code" href="class_prefab.html#a0deb004950b8dc4f51836316fd19c111">Base::instance</a>();</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// Retrieve headers</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>=<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$this-&gt;headers</a>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">// Connect to the server</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">if</span> (!$mock) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            $socket=&amp;<a class="code" href="class_s_m_t_p.html#a33a9dcf5eaeebf833f2390060f8caf5e">$this-&gt;socket</a>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            $socket=@fsockopen($this-&gt;host,$this-&gt;port,$errno,$errstr);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">if</span> (!$socket) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                $fw-&gt;error(500,$errstr);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="keywordflow">return</span> FALSE;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            stream_set_blocking($socket,TRUE);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// Get server&#39;s initial response</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(NULL,TRUE,$mock);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// Announce presence</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        $reply=$this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;EHLO &#39;</span>.$fw-&gt;get(<span class="stringliteral">&#39;HOST&#39;</span>),<a class="code" href="class_s_m_t_p.html#a9a2cf15a653aee8be437f7ae474cd494">$log</a>,$mock);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">if</span> (strtolower($this-&gt;scheme)==<span class="stringliteral">&#39;tls&#39;</span>) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;STARTTLS&#39;</span>,$log,$mock);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">if</span> (!$mock)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                stream_socket_enable_crypto(</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    $socket,TRUE,STREAM_CRYPTO_METHOD_TLS_CLIENT);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            $reply=$this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;EHLO &#39;</span>.$fw-&gt;get(<span class="stringliteral">&#39;HOST&#39;</span>),<a class="code" href="class_s_m_t_p.html#a9a2cf15a653aee8be437f7ae474cd494">$log</a>,$mock);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/8BITMIME/&#39;</span>,$reply))</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Content-Transfer-Encoding&#39;</span>]=<span class="stringliteral">&#39;8bit&#39;</span>;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Content-Transfer-Encoding&#39;</span>]=<span class="stringliteral">&#39;quoted-printable&#39;</span>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            $message=preg_replace(<span class="stringliteral">&#39;/^\.(.+)/m&#39;</span>,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="stringliteral">&#39;..$1&#39;</span>,quoted_printable_encode($message));</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;user &amp;&amp; $this-&gt;pw &amp;&amp; preg_match(<span class="stringliteral">&#39;/AUTH/&#39;</span>,$reply)) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="comment">// Authenticate</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;AUTH LOGIN&#39;</span>,$log,$mock);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(base64_encode($this-&gt;user),$log,$mock);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            $auth_rply=$this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(base64_encode($this-&gt;pw),$log,$mock);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/^235\s.*/&#39;</span>,$auth_rply)) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;QUIT&#39;</span>,$log,$mock);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                <span class="keywordflow">if</span> (!$mock &amp;&amp; $socket)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    fclose($socket);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordflow">return</span> FALSE;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">if</span> (empty(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Message-ID&#39;</span>]))</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Message-ID&#39;</span>]=<span class="charliteral">&#39;&lt;&#39;</span>.uniqid(<span class="stringliteral">&#39;&#39;</span>,TRUE).<span class="charliteral">&#39;@&#39;</span>.$this-&gt;host.<span class="charliteral">&#39;&gt;&#39;</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> (empty(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Date&#39;</span>]))</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Date&#39;</span>]=date(<span class="charliteral">&#39;r&#39;</span>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="comment">// Required headers</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        $reqd=[<span class="stringliteral">&#39;From&#39;</span>,<span class="stringliteral">&#39;To&#39;</span>,<span class="stringliteral">&#39;Subject&#39;</span>];</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">foreach</span> ($reqd as $id)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span> (empty(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[$id]))</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                user_error(sprintf(self::E_Header,$id),E_USER_ERROR);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        $eol=<span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        $str=<span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">// Stringify headers</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">foreach</span> (<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a> as $key=&gt;&amp;$val) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">if</span> (!in_array($key,$reqd) &amp;&amp;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                (!$this-&gt;attachments ||</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                $key!=<span class="stringliteral">&#39;Content-Type&#39;</span> &amp;&amp;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                $key!=<span class="stringliteral">&#39;Content-Transfer-Encoding&#39;</span>))</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                $str.=$key.<span class="stringliteral">&#39;: &#39;</span>.$val.$eol;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">if</span> (in_array($key,[<span class="stringliteral">&#39;From&#39;</span>,<span class="stringliteral">&#39;To&#39;</span>,<span class="stringliteral">&#39;Cc&#39;</span>,<span class="stringliteral">&#39;Bcc&#39;</span>])) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                $email=<span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                preg_match_all(<span class="stringliteral">&#39;/(?:&quot;.+?&quot; )?(?:&lt;.+?&gt;|[^ ,]+)/&#39;</span>,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    $val,$matches,PREG_SET_ORDER);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keywordflow">foreach</span> ($matches as $raw)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    $email.=($email?<span class="stringliteral">&#39;, &#39;</span>:<span class="stringliteral">&#39;&#39;</span>).</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        (preg_match(<span class="stringliteral">&#39;/&lt;.+?&gt;/&#39;</span>,$raw[0])?</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                            $raw[0]:</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                            (<span class="charliteral">&#39;&lt;&#39;</span>.$raw[0].<span class="charliteral">&#39;&gt;&#39;</span>));</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                $val=$email;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            unset($val);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// Start message dialog</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;MAIL FROM: &#39;</span>.strstr(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;From&#39;</span>],<span class="charliteral">&#39;&lt;&#39;</span>),$log,$mock);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">foreach</span> ($fw-&gt;split(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;To&#39;</span>].</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            (isset(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Cc&#39;</span>])?(<span class="charliteral">&#39;;&#39;</span>.<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Cc&#39;</span>]):<span class="stringliteral">&#39;&#39;</span>).</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            (isset(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Bcc&#39;</span>])?(<span class="charliteral">&#39;;&#39;</span>.<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Bcc&#39;</span>]):<span class="stringliteral">&#39;&#39;</span>)) as $dst) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;RCPT TO: &#39;</span>.strstr($dst,<span class="charliteral">&#39;&lt;&#39;</span>),$log,$mock);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;DATA&#39;</span>,$log,$mock);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;attachments) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="comment">// Replace Content-Type</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            $type=<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Content-Type&#39;</span>];</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            unset(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Content-Type&#39;</span>]);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            $enc=<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Content-Transfer-Encoding&#39;</span>];</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            unset(<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a>[<span class="stringliteral">&#39;Content-Transfer-Encoding&#39;</span>]);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            $hash=uniqid(NULL,TRUE);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="comment">// Send mail headers</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            $out=<span class="stringliteral">&#39;Content-Type: multipart/mixed; boundary=&quot;&#39;</span>.$hash.<span class="charliteral">&#39;&quot;&#39;</span>.$eol;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">foreach</span> (<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a> as $key=&gt;$val)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="keywordflow">if</span> ($key!=<span class="stringliteral">&#39;Bcc&#39;</span>)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    $out.=$key.<span class="stringliteral">&#39;: &#39;</span>.$val.$eol;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            $out.=$eol;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            $out.=<span class="stringliteral">&#39;This is a multi-part message in MIME format&#39;</span>.$eol;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            $out.=$eol;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            $out.=<span class="stringliteral">&#39;--&#39;</span>.$hash.$eol;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            $out.=<span class="stringliteral">&#39;Content-Type: &#39;</span>.$type.$eol;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            $out.=<span class="stringliteral">&#39;Content-Transfer-Encoding: &#39;</span>.$enc.$eol;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            $out.=$str.$eol;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            $out.=$message.$eol;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordflow">foreach</span> ($this-&gt;attachments as $attachment) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keywordflow">if</span> (is_array($attachment[<span class="stringliteral">&#39;filename&#39;</span>]))</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    list($alias,$file)=each($attachment[<span class="stringliteral">&#39;filename&#39;</span>]);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    $alias=basename($file=$attachment[<span class="stringliteral">&#39;filename&#39;</span>]);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                $out.=<span class="stringliteral">&#39;--&#39;</span>.$hash.$eol;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                $out.=<span class="stringliteral">&#39;Content-Type: application/octet-stream&#39;</span>.$eol;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                $out.=<span class="stringliteral">&#39;Content-Transfer-Encoding: base64&#39;</span>.$eol;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordflow">if</span> ($attachment[<span class="stringliteral">&#39;cid&#39;</span>])</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    $out.=<span class="stringliteral">&#39;Content-ID: &#39;</span>.$attachment[<span class="stringliteral">&#39;cid&#39;</span>].$eol;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                $out.=<span class="stringliteral">&#39;Content-Disposition: attachment; &#39;</span>.</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    <span class="stringliteral">&#39;filename=&quot;&#39;</span>.$alias.<span class="charliteral">&#39;&quot;&#39;</span>.$eol;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                $out.=$eol;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                $out.=chunk_split(base64_encode(</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    file_get_contents($file))).$eol;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            $out.=$eol;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            $out.=<span class="stringliteral">&#39;--&#39;</span>.$hash.<span class="stringliteral">&#39;--&#39;</span>.$eol;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            $out.=<span class="charliteral">&#39;.&#39;</span>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>($out,TRUE,$mock);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="comment">// Send mail headers</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            $out=<span class="stringliteral">&#39;&#39;</span>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">foreach</span> (<a class="code" href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">$headers</a> as $key=&gt;$val)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                <span class="keywordflow">if</span> ($key!=<span class="stringliteral">&#39;Bcc&#39;</span>)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                    $out.=$key.<span class="stringliteral">&#39;: &#39;</span>.$val.$eol;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            $out.=$eol;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            $out.=$message.$eol;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            $out.=<span class="charliteral">&#39;.&#39;</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="comment">// Send message</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>($out,TRUE,$mock);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        $this-&gt;<a class="code" href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">dialog</a>(<span class="stringliteral">&#39;QUIT&#39;</span>,$log,$mock);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> (!$mock &amp;&amp; $socket)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            fclose($socket);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">return</span> TRUE;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno"><a class="line" href="class_s_m_t_p.html#ad7de317dd2066f6724c0a560b6791543">  338</a></span>&#160;    <span class="keyword">function</span> <a class="code" href="class_s_m_t_p.html#ad7de317dd2066f6724c0a560b6791543">__construct</a>(</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        $host=<span class="stringliteral">&#39;localhost&#39;</span>,$port=25,$scheme=NULL,$user=NULL,$pw=NULL) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        $this-&gt;headers=[</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="stringliteral">&#39;MIME-Version&#39;</span>=&gt;<span class="stringliteral">&#39;1.0&#39;</span>,</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="stringliteral">&#39;Content-Type&#39;</span>=&gt;<span class="stringliteral">&#39;text/plain; &#39;</span>.</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="stringliteral">&#39;charset=&#39;</span>.Base::instance()-&gt;get(<span class="stringliteral">&#39;ENCODING&#39;</span>)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        ];</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        $this-&gt;host=<a class="code" href="class_s_m_t_p.html#a711797613cb863ca0756df789c396bf2">$host</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">if</span> (strtolower($this-&gt;scheme=strtolower($scheme))==<span class="stringliteral">&#39;ssl&#39;</span>)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            $this-&gt;host=<span class="stringliteral">&#39;ssl://&#39;</span>.$host;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        $this-&gt;port=<a class="code" href="class_s_m_t_p.html#aa0787efab4b22e8a212882f3409d4c77">$port</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        $this-&gt;user=<a class="code" href="class_s_m_t_p.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        $this-&gt;pw=<a class="code" href="class_s_m_t_p.html#a4a84bb9d73addd9e90f2f34c36035df4">$pw</a>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div><div class="ttc" id="class_s_m_t_p_html_acddb7c5e0234289640206f7ee89c14e5"><div class="ttname"><a href="class_s_m_t_p.html#acddb7c5e0234289640206f7ee89c14e5">SMTP\attach</a></div><div class="ttdeci">attach($file, $alias=NULL, $cid=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00168">smtp.php:168</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a9a2cf15a653aee8be437f7ae474cd494"><div class="ttname"><a href="class_s_m_t_p.html#a9a2cf15a653aee8be437f7ae474cd494">SMTP\$log</a></div><div class="ttdeci">$log</div><div class="ttdoc">Server-client conversation. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a711797613cb863ca0756df789c396bf2"><div class="ttname"><a href="class_s_m_t_p.html#a711797613cb863ca0756df789c396bf2">SMTP\$host</a></div><div class="ttdeci">$host</div><div class="ttdoc">SMTP host. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_aa2f80297e973639eba0f2f8619fe783b"><div class="ttname"><a href="class_s_m_t_p.html#aa2f80297e973639eba0f2f8619fe783b">SMTP\$attachments</a></div><div class="ttdeci">$attachments</div><div class="ttdoc">E-mail attachments. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a1665950e3e3b63a02fc5a48706ac81c4"><div class="ttname"><a href="class_s_m_t_p.html#a1665950e3e3b63a02fc5a48706ac81c4">SMTP\$scheme</a></div><div class="ttdeci">$scheme</div><div class="ttdoc">TLS/SSL. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a5e06d9b7f0033278f40a41d081efbe71"><div class="ttname"><a href="class_s_m_t_p.html#a5e06d9b7f0033278f40a41d081efbe71">SMTP\log</a></div><div class="ttdeci">log()</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00112">smtp.php:112</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_aa0787efab4b22e8a212882f3409d4c77"><div class="ttname"><a href="class_s_m_t_p.html#aa0787efab4b22e8a212882f3409d4c77">SMTP\$port</a></div><div class="ttdeci">$port</div><div class="ttdoc">SMTP port. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_afee77a9b8498c6a0875b75ae7313e545"><div class="ttname"><a href="class_s_m_t_p.html#afee77a9b8498c6a0875b75ae7313e545">SMTP\fixheader</a></div><div class="ttdeci">fixheader($key)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00058">smtp.php:58</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a10a949ef75de6c82c98ac555f371ba83"><div class="ttname"><a href="class_s_m_t_p.html#a10a949ef75de6c82c98ac555f371ba83">SMTP\clear</a></div><div class="ttdeci">clear($key)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00103">smtp.php:103</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a3ea1a09993798da7eba3b05e89fca4c2"><div class="ttname"><a href="class_s_m_t_p.html#a3ea1a09993798da7eba3b05e89fca4c2">SMTP\E_Header</a></div><div class="ttdeci">const E_Header</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00028">smtp.php:28</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a4a84bb9d73addd9e90f2f34c36035df4"><div class="ttname"><a href="class_s_m_t_p.html#a4a84bb9d73addd9e90f2f34c36035df4">SMTP\$pw</a></div><div class="ttdeci">$pw</div><div class="ttdoc">Password. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_ae837eb485f6bf62b8bbe8e9007c04cb2"><div class="ttname"><a href="class_s_m_t_p.html#ae837eb485f6bf62b8bbe8e9007c04cb2">SMTP\E_Blank</a></div><div class="ttdeci">const E_Blank</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00029">smtp.php:29</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_ad7de317dd2066f6724c0a560b6791543"><div class="ttname"><a href="class_s_m_t_p.html#ad7de317dd2066f6724c0a560b6791543">SMTP\__construct</a></div><div class="ttdeci">__construct( $host='localhost', $port=25, $scheme=NULL, $user=NULL, $pw=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00338">smtp.php:338</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_aedc0129d8cb1011801aee1950c279caf"><div class="ttname"><a href="class_s_m_t_p.html#aedc0129d8cb1011801aee1950c279caf">SMTP\E_Attach</a></div><div class="ttdeci">const E_Attach</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00030">smtp.php:30</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_ab57e2499b18f17f0cf67e12d546ad225"><div class="ttname"><a href="class_s_m_t_p.html#ab57e2499b18f17f0cf67e12d546ad225">SMTP\dialog</a></div><div class="ttdeci">dialog($cmd=NULL, $log=TRUE, $mock=FALSE)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00123">smtp.php:123</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a52500036ee807241b8b4b7e2367c49ef"><div class="ttname"><a href="class_s_m_t_p.html#a52500036ee807241b8b4b7e2367c49ef">SMTP\$headers</a></div><div class="ttdeci">$headers</div><div class="ttdoc">Message properties. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_magic_html"><div class="ttname"><a href="class_magic.html">Magic</a></div><div class="ttdoc">PHP magic wrapper. </div><div class="ttdef"><b>Definition:</b> <a href="magic_8php_source.html#l00024">magic.php:24</a></div></div>
<div class="ttc" id="class_s_m_t_p_html"><div class="ttname"><a href="class_s_m_t_p.html">SMTP</a></div><div class="ttdoc">SMTP plug-in. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00024">smtp.php:24</a></div></div>
<div class="ttc" id="class_prefab_html_a0deb004950b8dc4f51836316fd19c111"><div class="ttname"><a href="class_prefab.html#a0deb004950b8dc4f51836316fd19c111">Prefab\instance</a></div><div class="ttdeci">static instance()</div><div class="ttdef"><b>Definition:</b> <a href="base_8php_source.html#l00030">base.php:30</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_ace1ae5be37bf26c172cc7ea4e1a65e26"><div class="ttname"><a href="class_s_m_t_p.html#ace1ae5be37bf26c172cc7ea4e1a65e26">SMTP\exists</a></div><div class="ttdeci">exists($key)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00068">smtp.php:68</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_acf11a2bd1ca8c23866ccadfbe1e0954d"><div class="ttname"><a href="class_s_m_t_p.html#acf11a2bd1ca8c23866ccadfbe1e0954d">SMTP\send</a></div><div class="ttdeci">send($message, $log=TRUE, $mock=FALSE)</div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00183">smtp.php:183</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a598ca4e71b15a1313ec95f0df1027ca5"><div class="ttname"><a href="class_s_m_t_p.html#a598ca4e71b15a1313ec95f0df1027ca5">SMTP\$user</a></div><div class="ttdeci">$user</div><div class="ttdoc">User ID. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
<div class="ttc" id="class_s_m_t_p_html_a33a9dcf5eaeebf833f2390060f8caf5e"><div class="ttname"><a href="class_s_m_t_p.html#a33a9dcf5eaeebf833f2390060f8caf5e">SMTP\$socket</a></div><div class="ttdeci">$socket</div><div class="ttdoc">TCP/IP socket. </div><div class="ttdef"><b>Definition:</b> <a href="smtp_8php_source.html#l00035">smtp.php:35</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
