<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fat-Free Framework: /Users/aplennevaux/GITHUB/Visionary-website/src/vendor/bcosca/fatfree/readme.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fatfreelogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fat-Free Framework
   &#160;<span id="projectnumber">3.6</span>
   </div>
   <div id="projectbrief">A powerful yet easy-to-use PHP micro-framework designed to help you build dynamic and robust web applications - fast!</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">/Users/aplennevaux/GITHUB/Visionary-website/src/vendor/bcosca/fatfree/readme.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[![Fat-Free Framework](ui/images/logo.png)](http://fatfree.sf.net/)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;**A powerful yet easy-to-use PHP micro-framework designed to help you build dynamic and robust Web applications - fast!**</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;[![Flattr this project](https://api.flattr.com/button/flattr-badge-large.png)](https://flattr.com/submit/auto?user_id=phpfatfree&amp;url=https://github.com/bcosca/fatfree)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Condensed in a single ~65KB file, F3 (as we fondly call it) gives you solid foundation, a mature code base, and a no-nonsense approach to writing Web applications. Under the hood is an easy-to-use Web development tool kit, a high-performance URL routing and cache engine, built-in code highlighting, and support for multilingual applications. It&#39;s lightweight, easy-to-use, and fast. Most of all, it doesn&#39;t get in your way.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;Whether you&#39;re a novice or an expert PHP programmer, F3 will get you up and running in no time. No unnecessary and painstaking installation procedures. No complex configuration required. No convoluted directory structures. There&#39;s no better time to start developing Web applications the easy way than right now!</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;F3 supports both SQL and NoSQL databases off-the-shelf: MySQL, SQLite, MSSQL/Sybase, PostgreSQL, DB2, and MongoDB. It also comes with powerful object-relational mappers for data abstraction and modeling that are just as lightweight as the framework. No configuration needed.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;That&#39;s not all. F3 is packaged with other optional plug-ins that extend its capabilities:-</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;* Fast and clean template engine,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;* Unit testing toolkit,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;* Database-managed sessions with automatic CSRF protection,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;* Markdown-to-HTML converter,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;* Atom/RSS feed reader,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;* Image processor,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;* Geodata handler,</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;* Google static maps,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;* On-the-fly Javascript/CSS compressor,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;* OpenID (consumer),</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;* Custom logger,</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;* Basket/Shopping cart,</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;* Pingback server/consumer,</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;* Unicode-aware string functions,</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;* SMTP over SSL/TLS,</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;* Tools for communicating with other servers,</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;* And more in a tiny supercharged package!</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;Unlike other frameworks, F3 aims to be usable - not usual.</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;[![Flattr this project](https://api.flattr.com/button/flattr-badge-large.png)](https://flattr.com/submit/auto?user_id=phpfatfree&amp;url=https://github.com/bcosca/fatfree)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;The philosophy behind the framework and its approach to software architecture is towards minimalism in structural components, avoiding application complexity and striking a balance between code elegance, application performance and programmer productivity.</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;[![Paypal](ui/images/paypal.png)](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=MJSQL8N5LPDAY)</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;![Bitcoin](ui/images/bitcoin.png)</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;## Table of Contents</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;* [Getting Started](#getting-started)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;* [Routing Engine](#routing-engine)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;* [Framework Variables](#framework-variables)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;* [Views and Templates](#views-and-templates)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;* [Databases](#databases)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;* [Plug-Ins](#plug-ins)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;* [Optimization](#optimization)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;* [Unit Testing](#unit-testing)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;* [Quick Reference](#quick-reference)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;* [Support and Licensing](#support-and-licensing)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;[![Twitter](ui/images/twitter.png)](https://twitter.com/phpfatfree)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;### Version 3.6 Is Finally Released!</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;The latest official release welcomes the summer with a bang and marks the final milestone in this version of the Fat-Free Framework. Packed with exciting new features and outstanding documentation that consumed significant time and effort to develop and refine, version 3.6 is now available for download. This edition is packed with a bunch of new usability and security features.</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;F3 has a stable enterprise-class architecture. Unbeatable performance, user-friendly features and a lightweight footprint. What more can you ask for?</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;It is highly recommended that experienced users develop new applications with this version to take advantage of the latest code base and its significant improvements.</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;## Introducing FatFreeFramework.com</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;**Detailed API documentation with lots of code examples and a graphic guide can now be found at [http://fatfreeframework.com/](http://fatfreeframework.com/).**</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;Of course this handy online reference is powered by F3! It showcases the framework&#39;s capability and performance. Check it out now.</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;## Getting Started</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;&gt; *A designer knows he has achieved perfection not when there is nothing left to add, but when there is nothing left to take away. -- Antoine de Saint-Exup√©ry*</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;Fat-Free Framework makes it easy to build entire Web sites in a jiffy. With the same power and brevity as modern Javascript toolkits and libraries, F3 helps you write better-looking and more reliable PHP programs. One glance at your PHP source code and anyone will find it easy to understand, how much you can accomplish in so few lines of code, and how powerful the results are.</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;F3 is one of the best documented frameworks around. Learning it costs next to nothing. No strict set of difficult-to-navigate directory structures and obtrusive programming steps. No truck load of configuration options just to display `&#39;Hello, World&#39;` in your browser. Fat-Free gives you a lot of freedom - and style - to get more work done with ease and in less time.</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;F3&#39;s declarative approach to programming makes it easy for novices and experts alike to understand PHP code. If you&#39;re familiar with the programming language Ruby, you&#39;ll notice the resemblance between Fat-Free and Sinatra micro-framework because they both employ a simple Domain-Specific Language for ReSTful Web services. But unlike Sinatra and its PHP incarnations (Fitzgerald, Limonade, Glue - to name a few), Fat-Free goes beyond just handling routes and requests. Views can be in any form, such as plain text, HTML, XML or an e-mail message. The framework comes with a fast and easy-to-use template engine. F3 also works seamlessly with other template engines, including Twig, Smarty, and PHP itself. Models communicate with F3&#39;s data mappers and the SQL helper for more complex interactions with various database engines. Other plug-ins extend the base functionality even more. It&#39;s a total Web development framework - with a lot of muscle!</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;### Enough Said - See For Yourself</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;Unzip the contents of the distribution package anywhere in your hard drive. By default, the framework file and optional plug-ins are located in the `lib/` path. Organize your directory structures any way you want. You may move the default folders to a path that&#39;s not Web-accessible for better security. Delete the plug-ins that you don&#39;t need. You can always restore them later and F3 will detect their presence automatically.</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;**Important:** If your application uses APC, Memcached, WinCache, XCache, or a filesystem cache, clear all cache entries first before overwriting an older version of the framework with a new one.</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;Make sure you&#39;re running the right version of PHP. F3 does not support versions earlier than PHP 5.3. You&#39;ll be getting syntax errors (false positives) all over the place because new language constructs and closures/anonymous functions are not supported by outdated PHP versions. To find out, open your console (`bash` shell on GNU/Linux, or `cmd.exe` on Windows):-</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;```</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;/path/to/php -v</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;```</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;PHP will let you know which particular version you&#39;re running and you should get something that looks similar to this:-</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;```</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;PHP 5.3.15 (cli) (built: Jul 20 2012 00:20:38)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;Copyright (c) 1997-2012 The PHP Group</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;Zend Engine v2.3.0, Copyright (c) 1998-2012 Zend Technologies</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;```</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;Upgrade if necessary and come back here if you&#39;ve made the jump to PHP 5.3 or a later release. If you need a PHP 5.3+ hosting service provider, try one of these services:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;* [A2 Hosting](http://www.a2hosting.com/2461-15-1-72.html)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;* [DreamHost](http://www.dreamhost.com/r.cgi?665472)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;* [Hostek](http://hostek.com/aff.php?aff=364&amp;plat=L)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;* [SiteGround](http://www.siteground.com/index.htm?referrerid=155694)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;### Hello, World: The Less-Than-A-Minute Fat-Free Recipe</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;Time to start writing our first application:-</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;``` php</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;$f3 = require(&#39;path/to/base.php&#39;);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;$f3-&gt;route(&#39;GET /&#39;,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    function() {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        echo &#39;Hello, world!&#39;;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;$f3-&gt;run();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;```</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;Prepend `base.php` on the first line with the appropriate path. Save the above code fragment as `index.php` in your Web root folder. We&#39;ve written our first Web page.</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;The first command tells the PHP interpreter that you want the framework&#39;s functions and features available to your application. The `$f3-&gt;route()` method informs Fat-Free that a Web page is available at the relative URL indicated by the slash (`/`). Anyone visiting your site located at `http://www.example.com/` will see the `&#39;Hello, world!&#39;` message because the URL `/` is equivalent to the root page. To create a route that branches out from the root page, like `http://www.example.com/inside/`, you can define another route with a simple `GET /inside` string.</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;The route described above tells the framework to render the page only when it receives a URL request using the HTTP `GET` method. More complex Web sites containing forms use other HTTP methods like `POST`, and you can also implement that as part of a `$f3-&gt;route()` specification.</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;If the framework sees an incoming request for your Web page located at the root URL `/`, it will automatically route the request to the callback function, which contains the code necessary to process the request and render the appropriate HTML stuff. In this example, we just send the string `&#39;Hello, world!&#39;` to the user&#39;s Web browser.</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;So we&#39;ve established our first route. But that won&#39;t do much, except to let F3 know that there&#39;s a process that will handle it and there&#39;s some text to display on the user&#39;s Web browser. If you have a lot more pages on your site, you need to set up different routes for each group. For now, let&#39;s keep it simple. To instruct the framework to start waiting for requests, we issue the `$f3-&gt;run()` command.</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;**Can&#39;t Get the Example Running?** If you&#39;re having trouble getting this simple program to run on your server, you may have to tweak your Web server settings a bit. Take a look at the sample Apache configuration in the following section (along with the Nginx and Lighttpd equivalents).</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;**Still having trouble?** Make sure the `$f3 = require(&#39;path/to/base.php&#39;);` assignment comes before any output in your script. `base.php` modifies the HTTP headers, so any character that is output to the browser before this assignment will cause errors.</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;## Routing Engine</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;### Overview</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;Our first example wasn&#39;t too hard to swallow, was it? If you like a little more flavor in your Fat-Free soup, insert another route before the `$f3-&gt;run()` command:-</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;``` php</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;$f3-&gt;route(&#39;GET /about&#39;,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    function() {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        echo &#39;Donations go to a local charity... us!&#39;;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;```</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;You don&#39;t want to clutter the global namespace with function names? Fat-Free recognizes different ways of mapping route handlers to OOP classes and methods:-</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;``` php</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;class WebPage {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    function display() {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        echo &#39;I cannot object to an object&#39;;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;$f3-&gt;route(&#39;GET /about&#39;,&#39;WebPage-&gt;display&#39;);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;```</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;HTTP requests can also be routed to static class methods:-</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;``` php</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;$f3-&gt;route(&#39;GET /login&#39;,&#39;Auth::login&#39;);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;```</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;Passed arguments are always provided as the second parameter:</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;``` php</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;$f3-&gt;route(&#39;GET /hello/@name&#39;,&#39;User::greet&#39;);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;class User {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   public static function greet($f3, $args) { //$args is type of Array</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;       echo &quot;Hello &quot; . $args[&#39;name&#39;];</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;```</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;If the provided name argument would be **foo** (/hello/foo), the following output would be shown:</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;```</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;Hello foo</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;```</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;### Routes and Tokens</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;As a demonstration of Fat-Free&#39;s powerful domain-specific language (DSL), you can specify a single route to handle different possibilities:-</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;``` php</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;$f3-&gt;route(&#39;GET /brew/@count&#39;,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    function($f3) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        echo $f3-&gt;get(&#39;PARAMS.count&#39;).&#39; bottles of beer on the wall.&#39;;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;```</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;This example shows how we can specify a token `@count` to represent part of a URL. The framework will serve any request URL that matches the `/brew/` prefix, like `/brew/99`, `/brew/98`, etc. This will display `&#39;99 bottles of beer on the wall&#39;` and `&#39;98 bottles of beer on the wall&#39;`, respectively. Fat-Free will also accept a page request for `/brew/unbreakable`. (Expect this to display `&#39;unbreakable bottles of beer on the wall&#39;`.) When such a dynamic route is specified, Fat-Free automagically populates the global `PARAMS` array variable with the value of the captured strings in the URL. The `$f3-&gt;get()` call inside the callback function retrieves the value of a framework variable. You can certainly apply this method in your code as part of the presentation or business logic. But we&#39;ll discuss that in greater detail later.</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;Notice that Fat-Free understands array dot-notation. You can use `PARAMS[&#39;count&#39;]` regular notation instead in code, which is prone to typo errors and unbalanced braces. In views and templates, the framework permits `@PARAMS.count` notation which is somewhat similar to Javascript. (We&#39;ll cover views and templates later.)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;Here&#39;s another way to access tokens in a request pattern:-</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;``` php</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;$f3-&gt;route(&#39;GET /brew/@count&#39;,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    function($f3,$params) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        echo $params[&#39;count&#39;].&#39; bottles of beer on the wall.&#39;;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;```</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;You can use the asterisk (`*`) to accept any URL after the `/brew` route - if you don&#39;t really care about the rest of the path:-</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;``` php</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;$f3-&gt;route(&#39;GET /brew/*&#39;,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    function() {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        echo &#39;Enough beer! We always end up here.&#39;;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;```</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;An important point to consider: You will get Fat-Free (and yourself) confused if you have both `GET /brew/@count` and `GET /brew/*` together in the same application. Use one or the other. Another thing: Fat-Free sees `GET /brew` as separate and distinct from the route `GET /brew/@count`. Each can have different route handlers.</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;### Dynamic Web Sites</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;Wait a second - in all the previous examples, we never really created any directory in our hard drive to store these routes. The short answer: we don&#39;t have to. All F3 routes are virtual. They don&#39;t mirror our hard disk folder structure. If you have programs or static files (images, CSS, etc.) that do not use the framework - as long as the paths to these files do not conflict with any route defined in your application - your Web server software will deliver them to the user&#39;s browser, provided the server is configured properly.</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;### Named Routes</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;When you define a route, you can assign it a name. Use the route name in your code and templates instead of a typed url. Then if you need to change your urls to please the marketing overlords, you only need to make the change where the route was defined. The route names must follow php variable naming rules (no dots, dashes nor hyphens).</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;Let&#39;s name a route:-</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;``` php</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;$f3-&gt;route(&#39;GET @beer_list: /beer&#39;, &#39;Beer-&gt;list&#39;);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;```</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;The name is inserted after the route VERB (`GET` in this example) preceded by an `@` symbol, and separated from the URL portion by a colon `:` symbol. You can insert a space after the colon if that makes it easier to read your code (as shown here).</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;To access the named route in a template, get the value of the named route as the key of the `ALIASES` hive array:-</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;``` html</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;&lt;a href=&quot;{{ @ALIASES.beer_list }}&quot;&gt;View beer list&lt;/a&gt;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;```</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;To redirect the visitor to a new URL, call the named route inside the `reroute()` method like:-</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;``` php</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;// a named route is a string value</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;$f3-&gt;reroute(&#39;@beer_list&#39;); // note the single quotes</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;```</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;If you use tokens in your route, F3 will replace those tokens with their current value. If you want to change the token&#39;s value before calling reroute, pass it as the 2nd argument.:-</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;``` php</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;$f3-&gt;route(&#39;GET @beer_list: /beer/@country&#39;, &#39;Beer-&gt;bycountry&#39;);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;$f3-&gt;route(&#39;GET @beer_list: /beer/@country/@village&#39;, &#39;Beer-&gt;byvillage&#39;);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;// a set of key-value pairs is passed as argument to named route</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;$f3-&gt;reroute(&#39;@beer_list(@country=Germany)&#39;);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;// if more than one token needed</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;$f3-&gt;reroute(&#39;@beer_list(@country=Germany,@village=Rhine)&#39;);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;```</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;Remember to `urlencode()` your arguments if you have characters that do not comply with RFC 1738 guidelines for well-formed URLs.</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;### PHP 5.4&#39;s Built-In Web Server</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;PHP&#39;s latest stable version has its own built-in Web server. Start it up using the following configuration:-</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;```</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;php -S localhost:80 -t /var/www/</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;```</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;The above command will start routing all requests to the Web root `/var/www`. If an incoming HTTP request for a file or folder is received, PHP will look for it inside the Web root and send it over to the browser if found. Otherwise, PHP will load the default `index.php` (containing your F3-enabled code).</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;### Sample Apache Configuration</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;If you&#39;re using Apache, make sure you activate the URL rewriting module (mod_rewrite) in your apache.conf (or httpd.conf) file. You should also create a .htaccess file containing the following:-</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;``` apache</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;RewriteEngine On</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;RewriteCond %{REQUEST_FILENAME} !-f</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;RewriteCond %{REQUEST_FILENAME} !-d</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;RewriteCond %{REQUEST_FILENAME} !-l</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;RewriteRule .* index.php [L,QSA]</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;```</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;The script tells Apache that whenever an HTTP request arrives and if no physical file (`!-f`) or path (`!-d`) or symbolic link (`!-l`) can be found, it should transfer control to `index.php`, which contains our main/front controller, and which in turn, invokes the framework.</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;The `.htaccess file` containing the Apache directives stated above should always be in the same folder as `index.php`.</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;You also need to set up Apache so it knows the physical location of `index.php` in your hard drive. A typical configuration is:-</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;``` apache</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;DocumentRoot &quot;/var/www/html&quot;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;&lt;Directory &quot;/var/www/html&quot;&gt;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    Options -Indexes +FollowSymLinks +Includes</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    AllowOverride All</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    Order allow,deny</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    Allow from All</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;&lt;/Directory&gt;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;```</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;If you&#39;re developing several applications simultaneously, a virtual host configuration is easier to manage:-</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;``` apache</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;NameVirtualHost *</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;&lt;VirtualHost *&gt;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    ServerName site1.com</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    DocumentRoot &quot;/var/www/site1&quot;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    &lt;Directory &quot;/var/www/site1&quot;&gt;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        Options -Indexes +FollowSymLinks +Includes</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        AllowOverride All</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        Order allow,deny</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        Allow from All</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    &lt;/Directory&gt;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;&lt;/VirtualHost&gt;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;&lt;VirtualHost *&gt;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    ServerName site2.com</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    DocumentRoot &quot;/var/www/site2&quot;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    &lt;Directory &quot;/var/www/site2&quot;&gt;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        Options -Indexes +FollowSymLinks +Includes</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        AllowOverride All</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        Order allow,deny</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        Allow from All</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    &lt;/Directory&gt;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;&lt;/VirtualHost&gt;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;```</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;Each `ServerName` (`site1.com` and `site2.com` in our example) must be listed in your `/etc/hosts` file. On Windows, you should edit `C:/WINDOWS/system32/drivers/etc/hosts`. A reboot might be necessary to effect the changes. You can then point your Web browser to the address `http://site1.com` or `http://site2.com`. Virtual hosts make your applications a lot easier to deploy.</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;### Sample Nginx Configuration</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;For Nginx servers, here&#39;s the recommended configuration (replace ip_address:port with your environment&#39;s FastCGI PHP settings):-</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;``` nginx</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;server {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    root /var/www/html;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    location / {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        index index.php index.html index.htm;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        try_files $uri $uri/ /index.php?$query_string;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    location ~ \.php$ {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        fastcgi_pass ip_address:port;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        include fastcgi_params;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;```</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;### Sample Lighttpd Configuration</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;Lighttpd servers are configured in a similar manner:-</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;```</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;$HTTP[&quot;host&quot;] =~ &quot;www\.example\.com$&quot; {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    url.rewrite-once = ( &quot;^/(.*?)(\?.+)?$&quot;=&gt;&quot;/index.php/$1?$2&quot; )</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    server.error-handler-404 = &quot;/index.php&quot;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;```</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;### Sample IIS Configuration</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;Install the [URL rewrite module](http://www.iis.net/downloads/microsoft/url-rewrite) and the appropriate .NET framework corresponding to your Windows version. Then create a file named `web.config` in your application root with the following contents:</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;```</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;&lt;configuration&gt;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  &lt;system.webServer&gt;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    &lt;rewrite&gt;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      &lt;rules&gt;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        &lt;rule name=&quot;Application&quot; stopProcessing=&quot;true&quot;&gt;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          &lt;match url=&quot;.*&quot; ignoreCase=&quot;false&quot; /&gt;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          &lt;conditions logicalGrouping=&quot;MatchAll&quot;&gt;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            &lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsFile&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&gt;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            &lt;add input=&quot;{REQUEST_FILENAME}&quot; matchType=&quot;IsDirectory&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&gt;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          &lt;/conditions&gt;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          &lt;action type=&quot;Rewrite&quot; url=&quot;index.php&quot; appendQueryString=&quot;true&quot; /&gt;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        &lt;/rule&gt;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      &lt;/rules&gt;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    &lt;/rewrite&gt;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  &lt;/system.webServer&gt;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;&lt;/configuration&gt;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;```</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;### Rerouting</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;So let&#39;s get back to coding. You can declare a page obsolete and redirect your visitors to another site/page:-</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;``` php</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;$f3-&gt;route(&#39;GET|HEAD /obsoletepage&#39;,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    function($f3) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        $f3-&gt;reroute(&#39;/newpage&#39;);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;```</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;If someone tries to access the URL `http://www.example.com/obsoletepage` using either HTTP GET or HEAD request, the framework redirects the user to the URL: `http://www.example.com/newpage` as shown in the above example. You can also redirect the user to another site, like `$f3-&gt;reroute(&#39;http://www.anotherexample.org/&#39;);`.</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;Rerouting can be particularly useful when you need to do some maintenance work on your site. You can have a route handler that informs your visitors that your site is offline for a short period.</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;HTTP redirects are indispensable but they can also be expensive. As much as possible, refrain from using `$f3-&gt;reroute()` to send a user to another page on the same Web site if you can direct the flow of your application by invoking the function or method that handles the target route. However, this approach will not change the URL on the address bar of the user&#39;s Web browser. If this is not the behavior you want and you really need to send a user to another page, in instances like successful submission of a form or after a user has been authenticated, Fat-Free sends an `HTTP 303 See Other` header. For all other attempts to reroute to another page or site, the framework sends an `HTTP 301 Moved Permanently` header.</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;### Triggering a 404</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;At runtime, Fat-Free automatically generates an HTTP 404 error whenever it sees that an incoming HTTP request does not match any of the routes defined in your application. However, there are instances when you need to trigger it yourself.</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;Take for instance a route defined as `GET /dogs/@breed`. Your application logic may involve searching a database and attempting to retrieve the record corresponding to the value of `@breed` in the incoming HTTP request. Since Fat-Free will accept any value after the `/dogs/` prefix because of the presence of the `@breed` token, displaying an `HTTP 404 Not Found` message programmatically becomes necessary when the program doesn&#39;t find any match in our database. To do that, use the following command:-</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;``` php</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;$f3-&gt;error(404);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;```</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;### Representational State Transfer (ReST)</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;Fat-Free&#39;s architecture is based on the concept that HTTP URIs represent abstract Web resources (not limited to HTML) and each resource can move from one application state to another. For this reason, F3 does not have any restrictions on the way you structure your application. If you prefer to use the [Model-View-Controller](http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller) pattern, F3 can help you compartmentalize your application components to stick to this paradigm. On the other hand, the framework also supports the [Resource-Method-Representation](http://www.peej.co.uk/articles/rmr-architecture.html) pattern, and implementing it is more straightforward.</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;Here&#39;s an example of a ReST interface:-</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;``` php</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;class Item {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    function get() {}</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    function post() {}</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    function put() {}</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    function delete() {}</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;$f3=require(&#39;lib/base.php&#39;);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;$f3-&gt;map(&#39;/cart/@item&#39;,&#39;Item&#39;);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;$f3-&gt;run();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;```</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;Fat-Free&#39;s `$f3-&gt;map()` method provides a ReST interface by mapping HTTP methods in routes to the equivalent methods of an object or a PHP class. If your application receives an incoming HTTP request like `GET /cart/123`, Fat-Free will automatically transfer control to the object&#39;s or class&#39; `get()` method. On the other hand, a `POST /cart/123` request will be routed to the `Item` class&#39; `post()` method.</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;**Note:** Browsers do not implement the HTTP `PUT` and `DELETE` methods in regular HTML forms. These and other ReST methods (`HEAD`, and `CONNECT`) are accessible only via AJAX calls to the server.</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;If the framework receives an HTTP request for a route that maps to a method that is not implemented by a class (perhaps you&#39;ve made an error in the route mapping, or the method is not written yet), it generates an `HTTP 405 Method Not Allowed` error.</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;If a client requests HTTP `OPTIONS` for a URL resource, F3 responds with the appropriate HTTP headers that indicate which methods are allowed for the resource (HEAD, GET, PUT, etc). The framework will not map the `OPTIONS` request to a class.</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;### The F3 Autoloader</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;Fat-Free has a way of loading classes only at the time you need them, so they don&#39;t gobble up more memory than a particular segment of your application needs. And you don&#39;t have to write a long list of `include` or `require` statements just to load PHP classes saved in different files and different locations. The framework can do this automatically for you. Just save your files (one class per file) in a folder and tell the framework to automatically load the appropriate file once you invoke a method in the class:-</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;``` php</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;$f3-&gt;set(&#39;AUTOLOAD&#39;,&#39;autoload/&#39;);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;```</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;You can assign a different location for your autoloaded classes by changing the value of the `AUTOLOAD` global variable. You can also have multiple autoload paths. If you have your classes organized and in different folders, you can instruct the framework to autoload the appropriate class when a static method is called or when an object is instantiated. Modify the `AUTOLOAD` variable this way:-</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;``` php</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;$f3-&gt;set(&#39;AUTOLOAD&#39;,&#39;admin/autoload/; user/autoload/; default/&#39;);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;```</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;**Important:** Except for the .php extension, the class name and file name must be identical, for the framework to autoload your class properly. The basename of this file must be identical to your class invocation, e.g. F3 will look for either `Foo/BarBaz.php` or `foo/barbaz.php` when it detects a `new Foo\BarBaz` statement in your application.</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;### Working with Namespaces</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;`AUTOLOAD` allows class hierarchies to reside in similarly-named subfolders, so if you want the framework to autoload a PHP 5.3 namespaced class that&#39;s invoked in the following manner:-</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;``` php</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;$f3-&gt;set(&#39;AUTOLOAD&#39;,&#39;autoload/&#39;);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;$obj=new Gadgets\iPad;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;```</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;You can create a folder hierarchy that follows the same structure. Assuming `/var/www/html/` is your Web root, then F3 will look for the class in `/var/www/html/autoload/gadgets/ipad.php`. The file `ipad.php` should have the following minimum code:-</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;``` php</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;namespace Gadgets;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;class iPad {}</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;```</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;Remember: All directory names in Fat-Free must end with a slash. You can assign a search path for the autoloader as follows:-</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;``` php</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;$f3-&gt;set(&#39;AUTOLOAD&#39;,&#39;main/;aux/&#39;);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;```</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;### Routing to a Namespaced Class</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;F3, being a namespace-aware framework, allows you to use a method in namespaced class as a route handler, and there are several ways of doing it. To call a static method:-</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;``` php</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;$f3-&gt;set(&#39;AUTOLOAD&#39;,&#39;classes/&#39;);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;$f3-&gt;route(&#39;GET|POST /&#39;,&#39;Main\Home::show&#39;);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;```</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;The above code will invoke the static `show()` method of the class `Home` within the `Main` namespace. The `Home` class must be saved in the folder `classes/main/home.php` for it to be loaded automatically.</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;If you prefer to work with objects:-</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;``` php</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;$f3-&gt;route(&#39;GET|POST /&#39;,&#39;Main\Home-&gt;show&#39;);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;```</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;will instantiate the `Home` class at runtime and call the `show()` method thereafter.</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;### Event Handlers</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;F3 has a couple of routing event listeners that might help you improve the flow and structure of controller classes. Say you have a route defined as follows:-</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;``` php</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;$f3-&gt;route(&#39;GET /&#39;,&#39;Main-&gt;home&#39;);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;```</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;If the application receives an HTTP request matching the above route, F3 instantiates `Main`, but before executing the `home()` method, the framework looks for a method in this class named `beforeRoute()`. In case it&#39;s found, F3 runs the code contained in the `beforeRoute()` event handler before transferring control to the `home()` method. Once this is accomplished, the framework looks for an `afterRoute()` event handler. Like `beforeRoute()`, the method gets executed if it&#39;s defined.</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;### Dynamic Route Handlers</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;Here&#39;s another F3 goodie:-</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;``` php</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;$f3-&gt;route(&#39;GET /products/@action&#39;,&#39;Products-&gt;@action&#39;);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;```</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;If your application receives a request for, say, `/products/itemize`, F3 will extract the `&#39;itemize&#39;` string from the URL and pass it on to the `@action` token in the route handler. F3 will then look for a class named `Products` and execute the `itemize()` method.</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;Dynamic route handlers may have various forms:-</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;``` php</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;// static method</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;$f3-&gt;route(&#39;GET /public/@genre&#39;,&#39;Main::@genre&#39;);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;// object mode</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;$f3-&gt;route(&#39;GET /public/@controller/@action&#39;,&#39;@controller-&gt;@action&#39;);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;```</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;F3 triggers an `HTTP 404 Not Found` error at runtime if it cannot transfer control to the class or method associated with the current route, i.e. an undefined class or method.</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;### AJAX and Synchronous Requests</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;Routing patterns may contain modifiers that direct the framework to base its routing decision on the type of HTTP request:-</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;``` php</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;$f3-&gt;route(&#39;GET /example [ajax]&#39;,&#39;Page-&gt;getFragment&#39;);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;$f3-&gt;route(&#39;GET /example [sync]&#39;,&#39;Page-&gt;getFull&#39;);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;```</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;The first statement will route the HTTP request to the `Page-&gt;getFragment()` callback only if an `X-Requested-With: XMLHttpRequest` header (AJAX object) is received by the server. If an ordinary (synchronous) request is detected, F3 will simply drop down to the next matching pattern, and in this case it executes the `Page-&gt;getFull()` callback.</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;If no modifiers are defined in a routing pattern, then both AJAX and synchronous request types are routed to the specified handler.</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;Route pattern modifiers are also recognized by `$f3-&gt;map()`.</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;## Framework Variables</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;### Basic Use</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;Variables defined in Fat-Free are global, i.e. they can be accessed by any MVC component. Framework globals are not identical to PHP globals. An F3 variable named `content` is not identical to PHP&#39;s `$content`. F3 is a domain-specific language in its own right and maintains its own separate symbol table for system and application variables. The framework, like every well-designed object-oriented program, does not pollute the PHP global namespace with constants, variables, functions or classes that might conflict with any application. Unlike other frameworks, F3 does not use PHP&#39;s `define()` statement. All framework constants are confined to classes.</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;To assign a value to a Fat-Free variable:</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;``` php</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;$f3-&gt;set(&#39;var&#39;,value)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;```</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;**Note:** Fat-Free variables accept all PHP data types, including objects and anonymous functions.</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;To set several variables at once:</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;``` php</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;$f3-&gt;mset(</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    array(</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        &#39;foo&#39;=&gt;&#39;bar&#39;,</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        &#39;baz&#39;=&gt;123</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    )</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;```</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;To retrieve the value of a framework variable named `var`:-</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;``` php</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;$f3-&gt;get(&#39;var&#39;)</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;```</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;To remove a Fat-Free variable from memory if you no longer need it (discard it so it doesn&#39;t interfere with your other functions/methods), use the method:-</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;``` php</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;$f3-&gt;clear(&#39;var&#39;)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;```</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;To find out if a variable has been previously defined:-</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;``` php</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;$f3-&gt;exists(&#39;var&#39;)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;```</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;### Globals</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;F3 maintains its own symbol table for framework and application variables, which are independent of PHP&#39;s. Some variables are mapped to PHP globals. Fat-Free&#39;s `SESSION` is equivalent to `$_SESSION`, and `REQUEST` maps to `$_REQUEST`. Use of framework variables is recommended, instead of PHP&#39;s, to help you with data transfer across different functions, classes and methods. They also have other advantages:-</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;* You can use framework variables directly in your templates.</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;* You don&#39;t have to instruct PHP to reference a variable outside the current scope using a global keyword inside each function or method. All F3 variables are global to your application.</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;* Setting the Fat-Free equivalent of a PHP global like `SESSION` also changes PHP&#39;s underlying `$_SESSION`. Altering the latter also alters the framework counterpart.</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;Fat-Free does not maintain just a dumb storage for variables and their values. It can also automate session management and other things. Assigning or retrieving a value through F3&#39;s `SESSION` variable auto-starts the session. If you use `$_SESSION` (or session-related functions) directly, instead of the framework variable `SESSION`, your application becomes responsible for managing sessions.</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;As a rule, framework variables do not persist between HTTP requests. Only `SESSION` and `COOKIE` (and their elements) which are mapped to PHP&#39;s `$_SESSION` and `$_COOKIE` global variables are exempt from the stateless nature of HTTP.</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;There are several predefined global variables used internally by Fat-Free, and you can certainly utilize them in your application. Be sure you know what you&#39;re doing. Altering some Fat-Free global variables may result in unexpected framework behavior.</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;The framework has several variables to help you keep your files and directory structures organized. We&#39;ve seen how we can automate class loading by using the `AUTOLOAD`. There&#39;s a `UI` global variable, which contains the path pointing to the location of your HTML views/templates. `DEBUG` is another variable you&#39;ll be using quite often during application development and it&#39;s used for setting the verbosity of error traces.</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;Refer to the [Quick Reference](#quick-reference) if you need a comprehensive list of built-in framework variables.</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;### Naming Rules</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;A framework variable may contain any number of letters, digits and underscores. It must start with an alpha character and should have no spaces. Variable names are case-sensitive.</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;F3 uses all-caps for internal predefined global variables. Nothing stops you from using variable names consisting of all-caps in your own program, but as a general rule, stick to lowercase (or camelCase) when you set up your own variables so you can avoid any possible conflict with current and future framework releases.</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;You should not use PHP reserved words like `if`, `for`, `class`, `default`, etc. as framework variable names. These may cause unpredictable results.</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;### Working with String and Array Variables</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;F3 also provides a number of tools to help you with framework variables.</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;``` php</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;$f3-&gt;set(&#39;a&#39;,&#39;fire&#39;);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;$f3-&gt;concat(&#39;a&#39;,&#39;cracker&#39;);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;echo $f3-&gt;get(&#39;a&#39;); // returns the string &#39;firecracker&#39;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;$f3-&gt;copy(&#39;a&#39;,&#39;b&#39;);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;echo $f3-&gt;get(&#39;b&#39;); // returns the same string: &#39;firecracker&#39;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;```</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;F3 also provides some primitive methods for working with array variables:-</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;``` php</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;$f3-&gt;set(&#39;colors&#39;,array(&#39;red&#39;,&#39;blue&#39;,&#39;yellow&#39;));</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;$f3-&gt;push(&#39;colors&#39;,&#39;green&#39;); // works like PHP&#39;s array_push()</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;echo $f3-&gt;pop(&#39;colors&#39;); // returns &#39;green&#39;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;$f3-&gt;unshift(&#39;colors&#39;,&#39;purple&#39;); // similar to array_unshift()</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;echo $f3-&gt;shift(&#39;colors&#39;); // returns &#39;purple&#39;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;$f3-&gt;set(&#39;grays&#39;,array(&#39;light&#39;,&#39;dark&#39;));</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;$result=$f3-&gt;merge(&#39;colors&#39;,&#39;grays&#39;); // merges the two arrays</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;```</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;### Do-It-Yourself Directory Structures</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;Unlike other frameworks that have rigid folder structures, F3 gives you a lot of flexibility. You can have a folder structure that looks like this (parenthesized words in all-caps represent the F3 framework variables that need tweaking):-</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;```</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;/ (your Web root, where index.php is located)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;app/ (application files)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    dict/ (LOCALES, optional)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    controllers/</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    logs/ (LOGS, optional)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    models/</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    views/ (UI)</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;css/</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;js/</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;lib/ (you can store base.php here)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;tmp/ (TEMP, used by the framework)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   cache/ (CACHE)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;```</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;Feel free to organize your files and directories any way you want. Just set the appropriate F3 global variables. If you want a really secure site, Fat-Free even allows you to store all your files in a non-Web-accessible directory. The only requirement is that you leave `index.php`, `.htaccess` and your public files, like CSS, JavaScript, images, etc. in a path visible to your browser.</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;### About the F3 Error Handler</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;Fat-Free generates its own HTML error pages, with stack traces to help you with debugging. Here&#39;s an example:-</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;&gt; ---</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;&gt; ### Internal Server Error</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;&gt; strpos() expects at least 2 parameters, 0 given</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;&gt;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;&gt;     ‚Ä¢ var/html/dev/main.php:96 strpos()</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;&gt;     ‚Ä¢ var/html/dev/index.php:16 Base-&gt;run()</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;&gt; ---</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;If you feel it&#39;s a bit too plain or wish to do other things when the error occurs, you may create your own custom error handler:-</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;``` php</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;$f3-&gt;set(&#39;ONERROR&#39;,</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    function($f3) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        // custom error handler code goes here</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        // use this if you want to display errors in a</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        // format consistent with your site&#39;s theme</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        echo $f3-&gt;get(&#39;ERROR.status&#39;);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;```</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;F3 maintains a global variable containing the details of the latest error that occurred in your application. The `ERROR` variable is an array structured as follows:-</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;```</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;ERROR.code - displays the error code (404, 500, etc.)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;ERROR.status - header and page title</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;ERROR.text - error context</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;ERROR.trace - stack trace</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;```</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;While developing your application, it&#39;s best to set the debug level to maximum so you can trace all errors to their root cause:-</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;``` php</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;$f3-&gt;set(&#39;DEBUG&#39;,3);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;```</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;Just insert the command in your application&#39;s bootstrap sequence.</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;Once your application is ready for release, simply remove the statement from your application, or replace it with:-</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;``` php</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;$f3-&gt;set(&#39;DEBUG&#39;,0);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;```</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;This will suppress the stack trace output in any system-generated HTML error page (because it&#39;s not meant to be seen by your site visitors).</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;`DEBUG` can have values ranging from 0 (stack trace suppressed) to 3 (most verbose).</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;**Don&#39;t forget!** Stack traces may contain paths, file names, database commands, user names and passwords. You might expose your Web site to unnecessary security risks if you fail to set the `DEBUG` global variable to 0 in a production environment.</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;### Configuration Files</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;If your application needs to be user-configurable, F3 provides a handy method for reading configuration files to set up your application. This way, you and your users can tweak the application without altering any PHP code.</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;Instead of creating a PHP script that contains the following sample code:-</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;``` php</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;$f3-&gt;set(&#39;num&#39;,123);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;$f3-&gt;set(&#39;str&#39;,&#39;abc&#39;);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;$f3-&gt;set(&#39;hash&#39;,array(&#39;x&#39;=&gt;1,&#39;y&#39;=&gt;2,&#39;z&#39;=&gt;3));</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;$f3-&gt;set(&#39;items&#39;,array(7,8,9));</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;$f3-&gt;set(&#39;mix&#39;,array(&#39;this&#39;,123.45,FALSE));</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;```</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;You can construct a configuration file that does the same thing:-</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;``` ini</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;[globals]</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;num=123</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;; this is a regular string</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;str=abc</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;; another way of assigning strings</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;str=&quot;abc&quot;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;; this is an array</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;hash[x]=1</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;hash[y]=2</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;hash[z]=3</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;; dot-notation is recognized too</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;hash.x=1</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;hash.y=2</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;hash.z=3</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;; this is also an array</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;items=7,8,9</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;; array with mixed elements</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;mix=&quot;this&quot;,123.45,FALSE</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;```</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;Instead of lengthy `$f3-&gt;set()` statements in your code, you can instruct the framework to load a configuration file as code substitute. Let&#39;s save the above text as setup.cfg. We can then call it with a simple:-</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;``` php</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;$f3-&gt;config(&#39;setup.cfg&#39;);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;```</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;String values need not be quoted, unless you want leading or trailing spaces included. If a comma should be treated as part of a string, enclose the string using double-quotes - otherwise, the value will be treated as an array (the comma is used as an array element separator). Strings can span multiple lines:-</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;``` ini</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;[globals]</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;str=&quot;this is a \</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;very long \</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;string&quot;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;```</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;F3 also gives you the ability to define HTTP routes in configuration files:-</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;``` ini</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;[routes]</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;GET /=home</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;GET /404=App-&gt;page404</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;GET /page/@num=Page-&gt;@controller</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;```</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;Route maps can be defined in configuration files too:-</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;``` ini</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;[maps]</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;/blog=Blog\Login</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;/blog/@controller=Blog\@controller</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;```</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;The `[globals]`, `[routes]`, and `[maps]` section headers are required. You can combine both sections in a single configuration file - although having `[routes]` and `[maps]` in a separate file is recommended. This way you can allow end-users to modify some application-specific flags, and at the same time restrict them from meddling with your routing logic.</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;## Views and Templates</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;### Separation of Concerns</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;A user interface like an HTML page should be independent of the underlying PHP code related to routing and business logic. This is fundamental to the MVC paradigm. A basic revision like converting `&lt;h3&gt;` to `&lt;p&gt;` should not demand a change in your application code. In the same manner, transforming a simple route like `GET /about` to `GET /about-us` should not have any effect on your user interface and business logic, (the view and model in MVC, or representation and method in RMR).</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;Mixing programming constructs and user interface components in a single file, like spaghetti coding, makes future application maintenance a nightmare.</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;### PHP as a Template Engine</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;F3 supports PHP as a template engine. Take a look at this HTML fragment saved as `template.htm`:-.</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;``` html</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;&lt;p&gt;Hello, &lt;?php echo $name; ?&gt;!&lt;/p&gt;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;```</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;If short tags are enabled on your server, this should work too:-</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;``` html</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;&lt;p&gt;Hello, &lt;?= $name ?&gt;&lt;/p&gt;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;```</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;To display this template, you can have PHP code that looks like this (stored in a file separate from the template):-</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;``` php</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;$f3=require(&#39;lib/base.php&#39;);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;$f3-&gt;route(&#39;GET /&#39;,</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    function($f3) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        $f3-&gt;set(&#39;name&#39;,&#39;world&#39;);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        $view=new View;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        echo $view-&gt;render(&#39;template.htm&#39;);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        // Previous two lines can be shortened to:-</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        // echo View::instance()-&gt;render(&#39;template.htm&#39;);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;$f3-&gt;run();</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;```</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;The only issue with using PHP as a template engine, due to the embedded PHP code in these files, is the conscious effort needed to stick to the guidelines on separation of concerns and resist the temptation of mixing business logic with your user interface.</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;### A Quick Look at the F3 Template Language</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;As an alternative to PHP, you can use F3&#39;s own template engine. The above HTML fragment can be rewritten as:-</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;``` html</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;&lt;p&gt;Hello, {{ @name }}!&lt;/p&gt;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;```</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;and the code needed to view this template:-</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;``` php</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;$f3=require(&#39;lib/base.php&#39;);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;$f3-&gt;route(&#39;GET /&#39;,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    function($f3) {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        $f3-&gt;set(&#39;name&#39;,&#39;world&#39;);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        $template=new Template;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        echo $template-&gt;render(&#39;template.htm&#39;);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        // Above lines can be written as:-</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        // echo Template::instance()-&gt;render(&#39;template.htm&#39;);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;$f3-&gt;run();</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;```</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;Like routing tokens used for catching variables in URLs (still remember the `GET /brew/@count` example in the previous section?), F3 template tokens begin with the `@` symbol followed by a series of letters and digits enclosed in curly braces. The first character must be alpha. Template tokens have a one-to-one correspondence with framework variables. The framework automatically replaces a token with the value stored in a variable of the same name.</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;In our example, F3 replaces the `@name` token in our template with the value we assigned to the name variable. At runtime, the output of the above code will be:-</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;``` html</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;&lt;p&gt;Hello, world&lt;/p&gt;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;```</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;Worried about performance of F3 templates? At runtime, the framework parses and compiles/converts an F3 template to PHP code the first time it&#39;s displayed via `$template-&gt;render()`. The framework then uses this compiled code in all subsequent calls. Hence, performance should be the same as PHP templates, if not better due to code optimization done by the template compiler when more complex templates are involved.</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;Whether you use PHP&#39;s template engine or F3&#39;s own, template rendering can be significantly faster if you have APC, WinCache or XCache available on your server.</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;As mentioned earlier, framework variables can hold any PHP data type. However, usage of non-scalar data types in F3 templates may produce strange results if you&#39;re not careful. Expressions in curly braces will always be evaluated and converted to string. You should limit your user interface variables to simple scalars:- `string`, `integer`, `boolean` or `float` data types.</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;But what about arrays? Fat-Free recognizes arrays and you can employ them in your templates. You can have something like:-</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;``` html</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;&lt;p&gt;{{ @buddy[0] }}, {{ @buddy[1] }}, and {{ @buddy[2] }}&lt;/p&gt;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;```</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;And populate the `@buddy` array in your PHP code before serving the template:-</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;``` php</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;$f3-&gt;set(&#39;buddy&#39;,array(&#39;Tom&#39;,&#39;Dick&#39;,&#39;Harry&#39;));</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;```</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;However, if you simply insert `{{ @buddy }}` in your template, PHP 5.3 will replace it with `&#39;Array&#39;` because it converts the token to a string. PHP 5.4, on the other hand, will generate an `Array to string conversion` notice at runtime.</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;F3 allows you to embed expressions in templates. These expressions may take on various forms, like arithmetic calculations, boolean expressions, PHP constants, etc. Here are a few examples:-</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;``` html</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;{{ 2*(@page-1) }}</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{{ (int)765.29+1.2e3 }}</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;&lt;option value=&quot;F&quot; {{ @active?&#39;selected=&quot;selected&quot;&#39;:&#39;&#39; }}&gt;Female&lt;/option&gt;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;{{ var_dump(@xyz) }}</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;&lt;p&gt;That is {{ preg_match(&#39;/Yes/i&#39;,@response)?&#39;correct&#39;:&#39;wrong&#39; }}!&lt;/p&gt;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;{{ @obj-&gt;property }}</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;```</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;An additional note about array expressions: Take note that `@foo.@bar` is a string concatenation `$foo.$bar`), whereas `@foo.bar` translates to `$foo[&#39;bar&#39;]`. If `$foo[$bar]` is what you intended, use the `@foo[@bar]` regular notation.</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;Framework variables may also contain anonymous functions:</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;``` php</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;$f3-&gt;set(&#39;func&#39;,</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    function($a,$b) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        return $a.&#39;, &#39;.$b;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;```</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;The F3 template engine will interpret the token as expected, if you specify the following expression:</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;``` html</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{{ @func(&#39;hello&#39;,&#39;world&#39;) }}</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;```</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;### Templates Within Templates</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;Simple variable substitution is one thing all template engines have. Fat-Free has more up its sleeves:-</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;``` html</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;&lt;include href=&quot;header.htm&quot; /&gt;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;```</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;The &lt;include&gt; directive will embed the contents of the header.htm template at the exact position where the directive is stated. You can also have dynamic content in the form of:-</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;``` html</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;&lt;include href=&quot;{{ @content }}&quot; /&gt;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;```</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;A practical use for such template directive is when you have several pages with a common HTML layout but with different content. Instructing the framework to insert a sub-template into your main template is as simple as writing the following PHP code:-</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;``` php</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;// switch content to your blog sub-template</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;$f3-&gt;set(&#39;content&#39;,&#39;blog.htm&#39;);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;// in another route, switch content to the wiki sub-template</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;$f3-&gt;set(&#39;content&#39;,&#39;wiki.htm&#39;);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;```</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;A sub-template may in turn contain any number of &lt;include&gt; directives. F3 allows unlimited nested templates.</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;You can specify filenames with something other than .htm or .html file extensions, but it&#39;s easier to preview them in your Web browser during the development and debugging phase. The template engine is not limited to rendering HTML files. In fact you can use the template engine to render other kinds of files.</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;The `&lt;include&gt;` directive also has an optional `if` attribute so you can specify a condition that needs to be satisfied before the sub-template is inserted:-</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;``` html</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;&lt;include if=&quot;{{ count(@items) }}&quot; href=&quot;items.htm&quot; /&gt;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;```</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;### Exclusion of Segments</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;During the course of writing/debugging F3-powered programs and designing templates, there may be instances when disabling the display of a block of HTML may be handy. You can use the `&lt;exclude&gt;` directive for this purpose:-</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;``` html</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;&lt;exclude&gt;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    &lt;p&gt;A chunk of HTML we don&#39;t want displayed at the moment&lt;/p&gt;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;&lt;/exclude&gt;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;```</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;That&#39;s like the `&lt;!-- comment --&gt;` HTML comment tag, but the `&lt;exclude&gt;` directive makes the HTML block totally invisible once the template is rendered.</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;Here&#39;s another way of excluding template content or adding comments:-</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;``` html</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;{* &lt;p&gt;A chunk of HTML we don&#39;t want displayed at the moment&lt;/p&gt; *}</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;```</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;### Conditional Segments</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;Another useful template feature is the `&lt;check&gt;` directive. It allows you to embed an HTML fragment depending on the evaluation of a certain condition. Here are a few examples:-</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;``` html</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;&lt;check if=&quot;{{ @page==&#39;Home&#39; }}&quot;&gt;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    &lt;false&gt;&lt;span&gt;Inserted if condition is false&lt;/span&gt;&lt;/false&gt;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;&lt;/check&gt;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;&lt;check if=&quot;{{ @gender==&#39;M&#39; }}&quot;&gt;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    &lt;true&gt;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        &lt;div&gt;Appears when condition is true&lt;/div&gt;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    &lt;/true&gt;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    &lt;false&gt;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        &lt;div&gt;Appears when condition is false&lt;/div&gt;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    &lt;/false&gt;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;&lt;/check&gt;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;```</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;You can have as many nested `&lt;check&gt;` directives as you need.</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;An F3 expression inside an if attribute that equates to `NULL`, an empty string, a boolean `FALSE`, an empty array or zero, automatically invokes `&lt;false&gt;`. If your template has no `&lt;false&gt;` block, then the `&lt;true&gt;` opening and closing tags are optional:-</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;``` html</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;&lt;check if=&quot;{{ @loggedin }}&quot;&gt;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    &lt;p&gt;HTML chunk to be included if condition is true&lt;/p&gt;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;&lt;/check&gt;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;```</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;### Repeating Segments</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;Fat-Free can also handle repetitive HTML blocks:-</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;``` html</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;&lt;repeat group=&quot;{{ @fruits }}&quot; value=&quot;{{ @fruit }}&quot;&gt;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    &lt;p&gt;{{ trim(@fruit) }}&lt;/p&gt;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;&lt;/repeat&gt;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;```</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;The `group` attribute `@fruits` inside the `&lt;repeat&gt;` directive must be an array and should be set in your PHP code accordingly:-</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;``` php</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;$f3-&gt;set(&#39;fruits&#39;,array(&#39;apple&#39;,&#39;orange &#39;,&#39; banana&#39;));</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;```</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;Nothing is gained by assigning a value to `@fruit` in your application code. Fat-Free ignores any preset value it may have because it uses the variable to represent the current item during iteration over the group. The output of the above HTML template fragment and the corresponding PHP code becomes:-</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;``` html</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;&lt;p&gt;apple&lt;/p&gt;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;&lt;p&gt;orange&lt;/p&gt;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;&lt;p&gt;banana&lt;/p&gt;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;```</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;The framework allows unlimited nesting of `&lt;repeat&gt;` blocks:-</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;``` html</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;&lt;repeat group=&quot;{{ @div }}&quot; key=&quot;{{ @ikey }}&quot; value=&quot;{{ @idiv }}&quot;&gt;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    &lt;div&gt;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        &lt;p&gt;&lt;span&gt;&lt;b&gt;{{ @ikey }}&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        &lt;p&gt;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        &lt;repeat group=&quot;{{ @idiv }}&quot; value=&quot;{{ @ispan }}&quot;&gt;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            &lt;span&gt;{{ @ispan }}&lt;/span&gt;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        &lt;/repeat&gt;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        &lt;/p&gt;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    &lt;/div&gt;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;&lt;/repeat&gt;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;```</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;Apply the following F3 command:-</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;``` php</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;$f3-&gt;set(&#39;div&#39;,</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    array(</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        &#39;coffee&#39;=&gt;array(&#39;arabica&#39;,&#39;barako&#39;,&#39;liberica&#39;,&#39;kopiluwak&#39;),</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        &#39;tea&#39;=&gt;array(&#39;darjeeling&#39;,&#39;pekoe&#39;,&#39;samovar&#39;)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    )</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;```</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;As a result, you get the following HTML fragment:-</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;``` html</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;&lt;div&gt;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    &lt;p&gt;&lt;span&gt;&lt;b&gt;coffee&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    &lt;p&gt;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        &lt;span&gt;arabica&lt;/span&gt;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        &lt;span&gt;barako&lt;/span&gt;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        &lt;span&gt;liberica&lt;/span&gt;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        &lt;span&gt;kopiluwak&lt;/span&gt;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    &lt;p&gt;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;&lt;div&gt;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    &lt;p&gt;&lt;span&gt;&lt;b&gt;tea&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    &lt;p&gt;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        &lt;span&gt;darjeeling&lt;/span&gt;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        &lt;span&gt;pekoe&lt;/span&gt;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        &lt;span&gt;samovar&lt;/span&gt;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    &lt;/p&gt;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;```</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;Amazing, isn&#39;t it? And the only thing you had to do in PHP was to define the contents of a single F3 variable `div` to replace the `@div` token. Fat-Free makes both programming and Web template design really easy.</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;The `&lt;repeat&gt;` template directive&#39;s `value` attribute returns the value of the current element in the iteration. If you need to get the array key of the current element, use the `key` attribute instead. The `key` attribute is optional.</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;`&lt;repeat&gt;` also has an optional counter attribute that can be used as follows:-</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;``` html</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;&lt;repeat group=&quot;{{ @fruits }}&quot; value=&quot;{{ @fruit }}&quot; counter=&quot;{{ @ctr }}&quot;&gt;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    &lt;p class=&quot;{{ @ctr%2?&#39;odd&#39;:&#39;even&#39; }}&quot;&gt;{{ trim(@fruit) }}&lt;/p&gt;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;&lt;/repeat&gt;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;```</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;Internally, F3&#39;s template engine records the number of loop iterations and saves that value in the variable/token `@ctr`, which is used in our example to determine the odd/even classification.</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;### Embedding Javascript and CSS</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;If you have to insert F3 tokens inside a `&lt;script&gt;` or `&lt;style&gt;` section of your template, the framework will still replace them the usual way:-</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;``` html</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    function notify() {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        alert(&#39;You are logged in as: {{ @userID }}&#39;);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;&lt;/script&gt;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;```</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;Embedding template directives inside your `&lt;script&gt;` or `&lt;style&gt;` tags requires no special handling:-</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;``` html</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   var discounts=[];</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    &lt;repeat group=&quot;{{ @rates }}&quot; value=&quot;{{ @rate }}&quot;&gt;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        // whatever you want to repeat in Javascript, e.g.</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        discounts.push(&quot;{{ @rate }}&quot;);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    &lt;/repeat&gt;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;&lt;/script&gt;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;```</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;### Document Encoding</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;By default, Fat-Free uses the UTF-8 character set unless changed. You can override this behavior by issuing something like:-</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;``` php</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;$f3-&gt;set(&#39;ENCODING&#39;,&#39;ISO-8859-1&#39;);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;```</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;Once you inform the framework of the desired character set, F3 will use it in all HTML and XML templates until altered again.</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;### All Kinds of Templates</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;As mentioned earlier in this section, the framework isn&#39;t limited to HTML templates. You can process XML templates just as well. The mechanics are pretty much similar. You still have the same `{{ @variable }}` and `{{ expression }}` tokens, `&lt;repeat&gt;`, `&lt;check&gt;`, `&lt;include&gt;`, and `&lt;exclude&gt;` directives at your disposal. Just tell F3 that you&#39;re passing an XML file instead of HTML:-</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;``` php</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;echo Template::instance()-&gt;render(&#39;template.xml&#39;,&#39;application/xml&#39;);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;```</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;The second argument represents the MIME type of the document being rendered.</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;The View component of MVC covers everything that doesn&#39;t fall under the Model and Controller, which means your presentation can and should include all kinds of user interfaces, like RSS, e-mail, RDF, FOAF, text files, etc. The example below shows you how to separate your e-mail presentation from your application&#39;s business logic:-</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;``` html</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;MIME-Version: 1.0</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;Content-type: text/html; charset={{ @ENCODING }}</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;From: {{ @from }}</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;To: {{ @to }}</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;Subject: {{ @subject }}</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;&lt;p&gt;Welcome, and thanks for joining {{ @site }}!&lt;/p&gt;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;```</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;Save the above e-mail template as welcome.txt. The associated F3 code would be:-</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;``` php</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;$f3-&gt;set(&#39;from&#39;,&#39;&lt;no-reply@mysite.com&gt;&#39;);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;$f3-&gt;set(&#39;to&#39;,&#39;&lt;slasher@throats.com&gt;&#39;);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;$f3-&gt;set(&#39;subject&#39;,&#39;Welcome&#39;);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;ini_set(&#39;sendmail_from&#39;,$f3-&gt;get(&#39;from&#39;));</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;mail(</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    $f3-&gt;get(&#39;to&#39;),</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    $f3-&gt;get(&#39;subject&#39;),</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    Template::instance()-&gt;render(&#39;email.txt&#39;,&#39;text/html&#39;)</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;```</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;Tip: Replace the SMTP mail() function with imap_mail() if your script communicates with an IMAP server.</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;Now isn&#39;t that something? Of course, if you have a bundle of e-mail recipients, you&#39;d be using a database to populate the firstName, lastName, and email tokens.</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;Here&#39;s an alternative solution using the F3&#39;s SMTP plug-in:-</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;``` php</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;$mail=new SMTP(&#39;smtp.gmail.com&#39;,465,&#39;SSL&#39;,&#39;account@gmail.com&#39;,&#39;secret&#39;);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;$mail-&gt;set(&#39;from&#39;,&#39;&lt;no-reply@mysite.com&gt;&#39;);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;$mail-&gt;set(&#39;to&#39;,&#39;&quot;Slasher&quot; &lt;slasher@throats.com&gt;&#39;);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;$mail-&gt;set(&#39;subject&#39;,&#39;Welcome&#39;);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;$mail-&gt;send(Template::instance()-&gt;render(&#39;email.txt&#39;));</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;```</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;### Multilingual Support</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;F3 supports multiple languages right out of the box.</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;First, create a dictionary file with the following structure (one file per language):-</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;``` php</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;&lt;?php</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;return array(</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    &#39;love&#39;=&gt;&#39;I love F3&#39;,</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    &#39;today&#39;=&gt;&#39;Today is {0,date}&#39;,</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    &#39;pi&#39;=&gt;&#39;{0,number}&#39;,</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    &#39;money&#39;=&gt;&#39;Amount remaining: {0,number,currency}&#39;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;```</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;Save it as `dict/en.php`. Let&#39;s create another dictionary, this time for German. Save the file as `dict/de.php`:-</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;``` php</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;&lt;?php</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;return array(</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    &#39;love&#39;=&gt;&#39;Ich liebe F3&#39;,</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    &#39;today&#39;=&gt;&#39;Heute ist {0,date}&#39;,</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    &#39;money&#39;=&gt;&#39;Restbetrag: {0,number,currency}&#39;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;```</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;Dictionaries are nothing more than key-value pairs. F3 automatically instantiates framework variables based on the keys in the language files. As such, it&#39;s easy to embed these variables as tokens in your templates. Using the F3 template engine:-</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;``` html</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;&lt;h1&gt;{{ @love }}&lt;/h1&gt;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;&lt;p&gt;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;{{ @today,time() | format }}.&lt;br /&gt;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;{{ @money,365.25 | format }}&lt;br /&gt;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;{{ @pi }}</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;```</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;And the longer version that utilizes PHP as a template engine:-</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;``` php</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;&lt;?php $f3=Base::instance(); ?&gt;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;&lt;h1&gt;&lt;?php echo $f3-&gt;get(&#39;love&#39;); ?&gt;&lt;/h1&gt;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;&lt;p&gt;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    &lt;?php echo $f3-&gt;get(&#39;today&#39;,time()); ?&gt;.&lt;br /&gt;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    &lt;?php echo $f3-&gt;get(&#39;money&#39;,365.25); ?&gt;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    &lt;?php echo $f3-&gt;get(&#39;pi&#39;); ?&gt;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;```</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;Next, we instruct F3 to look for dictionaries in the `dict/` folder:-</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;``` php</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;$f3-&gt;set(&#39;LOCALES&#39;,&#39;dict/&#39;);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;```</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;But how does the framework determine which language to use? F3 will detect it automatically by looking at the HTTP request headers first, specifically the `Accept-Language` header sent by the browser.</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;To override this behavior, you can trigger F3 to use a language specified by the user or application:-</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;``` php</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;$f3-&gt;set(&#39;LANGUAGE&#39;,&#39;de&#39;);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;```</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;**Note:** In the above example, the key pi exists only in the English dictionary. The framework will always use English (`en`) as a fallback to populate keys that are not present in the specified (or detected) language.</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;You may also create dictionary files for language variants like `en-US`, `es-AR`, etc. In this case, F3 will use the language variant first (like `es-AR`). If there are keys that do not exist in the variant, the framework will look up the key in the root language (`es`), then use the `en` language file as the final fallback.</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;Dictionary key-value pairs become F3 variables once referenced. Make sure the keys do not conflict with any framework variable instantiated via `$f3-&gt;set()`, `$f3-&gt;mset()`, or `$f3-&gt;config()`.</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;Did you notice the peculiar `&#39;Today is {0,date}&#39;` pattern in our previous example? F3&#39;s multilingual capability hinges on string/message formatting rules of the ICU project. The framework uses its own subset of the ICU string formatting implementation. There is no need for PHP&#39;s `intl` extension to be activated on the server.</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;One more thing: F3 can also load .ini-style formatted files as dictionaries:-</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;``` ini</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;love=&quot;I love F3&quot;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;today=&quot;Today is {0,date}&quot;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;pi=&quot;{0,number}&quot;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;money=&quot;Amount remaining: {0,number,currency}&quot;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;```</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;Save it as `dict/en.ini` so the framework can load it automatically.</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;### Data Sanitation</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;By default, both view handler and template engine escapes all rendered variables, i.e. converted to HTML entities to protect you from possible XSS and code injection attacks. On the other hand, if you wish to pass valid HTML fragments from your application code to your template:-</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;``` php</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;$f3-&gt;set(&#39;ESCAPE&#39;,FALSE);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;```</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;This may have undesirable effects. You might not want all variables to pass through unescaped. Fat-Free allows you to unescape variables individually. For F3 templates:-</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;``` html</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;{{ @html_content | raw }}</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;```</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;In the case of PHP templates:-</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;``` php</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;&lt;?php echo View::instance()-&gt;raw($html_content); ?&gt;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;```</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;As an addition to auto-escaping of F3 variables, the framework also gives you a free hand at sanitizing user input from HTML forms:-</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;``` php</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;$f3-&gt;scrub($_GET,&#39;p; br; span; div; a&#39;);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;```</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;This command will strip all tags (except those specified in the second argument) and unsafe characters from the specified variable. If the variable contains an array, each element in the array is sanitized recursively. If an asterisk (*) is passed as the second argument, `$f3-&gt;scrub()` permits all HTML tags to pass through untouched and simply remove unsafe control characters.</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;## Databases</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;### Connecting to a Database Engine</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;Fat-Free is designed to make the job of interfacing with SQL databases a breeze. If you&#39;re not the type to immerse yourself in details about SQL, but lean more towards object-oriented data handling, you can go directly to the next section of this tutorial. However, if you need to do some complex data-handling and database performance optimization tasks, SQL is the way to go.</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;Establishing communication with a SQL engine like MySQL, SQLite, SQL Server, Sybase, and Oracle is done using the familiar `$f3-&gt;set()` command. Connecting to a SQLite database would be:-</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;``` php</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;$db=new DB\SQL(&#39;sqlite:/absolute/path/to/your/database.sqlite&#39;);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;```</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;Another example, this time with MySQL:-</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;``` php</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;$db=new DB\SQL(</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    &#39;mysql:host=localhost;port=3306;dbname=mysqldb&#39;,</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    &#39;admin&#39;,</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    &#39;p455w0rD&#39;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;```</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;### Querying the Database</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;OK. That was easy, wasn&#39;t it? That&#39;s pretty much how you would do the same thing in ordinary PHP. You just need to know the DSN format of the database you&#39;re connecting to. See the PDO section of the PHP manual.</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;Let&#39;s continue our PHP code:-</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;``` php</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;$f3-&gt;set(&#39;result&#39;,$db-&gt;exec(&#39;SELECT brandName FROM wherever&#39;));</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;echo Template::instance()-&gt;render(&#39;abc.htm&#39;);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;```</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;Huh, what&#39;s going on here? Shouldn&#39;t we be setting up things like PDOs, statements, cursors, etc.? The simple answer is: you don&#39;t have to. F3 simplifies everything by taking care of all the hard work in the backend.</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;This time we create an HTML template like `abc.htm` that has at a minimum the following:-</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;``` html</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;&lt;repeat group=&quot;{{ @result }}&quot; value=&quot;{{ @item }}&quot;&gt;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    &lt;span&gt;{{ @item.brandName  }}&lt;/span&gt;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;&lt;/repeat&gt;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;```</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;In most instances, the SQL command set should be enough to generate a Web-ready result so you can use the `result` array variable in your template directly. Be that as it may, Fat-Free will not stop you from getting into its SQL handler internals. In fact, F3&#39;s `DB\SQL` class derives directly from PHP&#39;s `PDO` class, so you still have access to the underlying PDO components and primitives involved in each process, if you need some fine-grain control.</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;### Transactions</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;Here&#39;s another example. Instead of a single statement provided as an argument to the `$db-&gt;exec()` command, you can also pass an array of SQL statements:-</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;``` php</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;$db-&gt;exec(</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    array(</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        &#39;DELETE FROM diet WHERE food=&quot;cola&quot;&#39;,</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        &#39;INSERT INTO diet (food) VALUES (&quot;carrot&quot;)&#39;,</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        &#39;SELECT * FROM diet&#39;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    )</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;```</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;F3 is smart enough to know that if you&#39;re passing an array of SQL instructions, this indicates a SQL batch transaction. You don&#39;t have to worry about SQL rollbacks and commits because the framework will automatically revert to the initial state of the database if any error occurs during the transaction. If successful, F3 commits all changes made to the database.</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;You can also start and end a transaction programmatically:-</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;``` php</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;$db-&gt;begin();</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;$db-&gt;exec(&#39;DELETE FROM diet WHERE food=&quot;cola&quot;&#39;);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;$db-&gt;exec(&#39;INSERT INTO diet (food) VALUES (&quot;carrot&quot;)&#39;);</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;$db-&gt;exec(&#39;SELECT * FROM diet&#39;);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;$db-&gt;commit();</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;```</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;A rollback will occur if any of the statements encounter an error.</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;To get a list of all database instructions issued:-</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;``` php</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;echo $db-&gt;log();</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;```</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;### Parameterized Queries</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;Passing string arguments to SQL statements is fraught with danger. Consider this:-</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;``` php</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;$db-&gt;exec(</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    &#39;SELECT * FROM users &#39;.</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    &#39;WHERE username=&quot;&#39;.$f3-&gt;get(&#39;POST.userID&#39;.&#39;&quot;&#39;)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;```</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;If the `POST` variable `userID` does not go through any data sanitation process, a malicious user can pass the following string and damage your database irreversibly:-</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;``` sql</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;admin&quot;; DELETE FROM users; SELECT &quot;1</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;```</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;Luckily, parameterized queries help you mitigate these risks:-</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;``` php</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;$db-&gt;exec(</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    &#39;SELECT * FROM users WHERE userID=?&#39;,</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    $f3-&gt;get(&#39;POST.userID&#39;)</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;```</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;If F3 detects that the value of the query parameter/token is a string, the underlying data access layer escapes the string and adds quotes as necessary.</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;Our example in the previous section will be a lot safer from SQL injection if written this way:-</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;``` php</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;$db-&gt;exec(</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    array(</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        &#39;DELETE FROM diet WHERE food=:name&#39;,</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        &#39;INSERT INTO diet (food) VALUES (?)&#39;,</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        &#39;SELECT * FROM diet&#39;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    ),</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    array(</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        array(&#39;:name&#39;=&gt;&#39;cola&#39;),</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        array(1=&gt;&#39;carrot&#39;),</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        NULL</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    )</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;```</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;### CRUD (But With a Lot of Style)</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;F3 is packed with easy-to-use object-relational mappers (ORMs) that sit between your application and your data - making it a lot easier and faster for you to write programs that handle common data operations - like creating, retrieving, updating, and deleting (CRUD) information from SQL and NoSQL databases. Data mappers do most of the work by mapping PHP object interactions to the corresponding backend queries.</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;Suppose you have an existing MySQL database containing a table of users of your application. (SQLite, PostgreSQL, SQL Server, Sybase will do just as well.) It would have been created using the following SQL command:-</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;``` sql</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;CREATE TABLE users (</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    userID VARCHAR(30),</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    password VARCHAR(30),</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    visits INT,</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    PRIMARY KEY(userID)</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;```</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;**Note:** MongoDB is a NoSQL database engine and inherently schema-less. F3 has its own fast and lightweight NoSQL implementation called Jig, which uses PHP-serialized or JSON-encoded flat files. These abstraction layers require no rigid data structures. Fields may vary from one record to another. They can also be defined or dropped on the fly.</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;Now back to SQL. First, we establish communication with our database.</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;``` php</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;$db=new DB\SQL(</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    &#39;mysql:host=localhost;port=3306;dbname=mysqldb&#39;,</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    &#39;admin&#39;,</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    &#39;wh4t3v3r&#39;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;```</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;To retrieve a record from our table:-</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;``` php</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;$user=new DB\SQL\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;$user-&gt;load(array(&#39;userID=?&#39;,&#39;tarzan&#39;));</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;```</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;The first line instantiates a data mapper object that interacts with the `users` table in our database. Behind the scene, F3 retrieves the structure of the `users` table and determines which field(s) are defined as primary key(s). At this point, the mapper object contains no data yet (dry state) so `$user` is nothing more than a structured object - but it contains the methods it needs to perform the basic CRUD operations and some extras. To retrieve a record from our users table with a `userID` field containing the string value `tarzan`, we use the `load() method`. This process is called &quot;auto-hydrating&quot; the data mapper object.</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;Easy, wasn&#39;t it? F3 understands that a SQL table already has a structural definition existing within the database engine itself. Unlike other frameworks, F3 requires no extra class declarations (unless you want to extend the data mappers to fit complex objects), no redundant PHP array/object property-to-field mappings (duplication of efforts), no code generators (which require code regeneration if the database structure changes), no stupid XML/YAML files to configure your models, no superfluous commands just to retrieve a single record. With F3, a simple resizing of a `varchar` field in MySQL does not demand a change in your application code. Consistent with MVC and &quot;separation of concerns&quot;, the database admin has as much control over the data (and the structures) as a template designer has over HTML/XML templates.</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;If you prefer working with NoSQL databases, the similarities in query syntax are superficial. In the case of the MongoDB data mapper, the equivalent code would be:-</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;``` php</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;$db=new DB\Mongo(&#39;mongodb://localhost:27017&#39;,&#39;testdb&#39;);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;$user=new DB\Mongo\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;$user-&gt;load(array(&#39;userID&#39;=&gt;&#39;tarzan&#39;));</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;```</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;With Jig, the syntax is similar to F3&#39;s template engine:-</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;``` php</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;$db=new DB\Jig(&#39;db/data/&#39;,DB\Jig::FORMAT_JSON);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;$user=new DB\Jig\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;$user-&gt;load(array(&#39;@userID=?&#39;,&#39;tarzan&#39;));</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;```</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;### The Smart SQL ORM</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;The framework automatically maps the field `visits` in our table to a data mapper property during object instantiation, i.e. `$user=new DB\SQL\Mapper($db,&#39;users&#39;);`. Once the object is created, `$user-&gt;password` and `$user-&gt;userID` would map to the `password` and `userID` fields in our table, respectively.</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;You can&#39;t add or delete a mapped field, or change a table&#39;s structure using the ORM. You must do this in MySQL, or whatever database engine you&#39;re using. After you make the changes in your database engine, Fat-Free will automatically synchronize the new table structure with your data mapper object when you run your application.</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;F3 derives the data mapper structure directly from the database schema. No guesswork involved. It understands the differences between MySQL, SQLite, MSSQL, Sybase, and PostgreSQL database engines.</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;SQL identifiers should not use reserved words, and should be limited to alphanumeric characters `A-Z`, `0-9`, and the underscore symbol (`_`). Column names containing spaces (or special characters) and surrounded by quotes in the data definition are not compatible with the ORM. They cannot be represented properly as PHP object properties.</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;Let&#39;s say we want to increment the user&#39;s number of visits and update the corresponding record in our users table, we can add the following code:-</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;``` php</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;$user-&gt;visits++;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;$user-&gt;save();</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;```</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;If we wanted to insert a record, we follow this process:-</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;``` php</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;$user=new DB\SQL\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;// or $user=new DB\Mongo\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;// or $user=new DB\Jig\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;$user-&gt;userID=&#39;jane&#39;;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;$user-&gt;password=md5(&#39;secret&#39;);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;$user-&gt;visits=0;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;$user-&gt;save();</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;```</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;We still use the same `save()` method. But how does F3 know when a record should be inserted or updated? At the time a data mapper object is auto-hydrated by a record retrieval, the framework keeps track of the record&#39;s primary keys (or `_id`, in the case of MongoDB and Jig) - so it knows which record should be updated or deleted - even when the values of the primary keys are changed. A programmatically-hydrated data mapper - the values of which were not retrieved from the database, but populated by the application - will not have any memory of previous values in its primary keys. The same applies to MongoDB and Jig, but using object `_id` as reference. So, when we instantiated the `$user` object above and populated its properties with values from our program - without at all retrieving a record from the user table, F3 knows that it should insert this record.</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;A mapper object will not be empty after a `save()`. If you wish to add a new record to your database, you must first dehydrate the mapper:-</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;``` php</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;$user-&gt;reset();</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;$user-&gt;userID=&#39;cheetah&#39;;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;$user-&gt;password=md5(&#39;unknown&#39;);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;$user-&gt;save();</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;```</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;Calling `save()` a second time without invoking `reset()` will simply update the record currently pointed to by the mapper.</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;### Caveat for SQL Tables</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;Although the issue of having primary keys in all tables in your database is argumentative, F3 does not stop you from creating a data mapper object that communicates with a table containing no primary keys. The only drawback is: you can&#39;t delete or update a mapped record because there&#39;s absolutely no way for F3 to determine which record you&#39;re referring to plus the fact that positional references are not reliable. Row IDs are not portable across different SQL engines and may not be returned by the PHP database driver.</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;To remove a mapped record from our table, invoke the `erase()` method on an auto-hydrated data mapper. For example:-</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;``` php</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;$user=new DB\SQL\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;$user-&gt;load(array(&#39;userID=? AND password=?&#39;,&#39;cheetah&#39;,&#39;ch1mp&#39;));</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;$user-&gt;erase();</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;```</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;Jig&#39;s query syntax would be slightly similar:-</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;``` php</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;$user=new DB\Jig\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;$user-&gt;load(array(&#39;@userID=? AND @password=?&#39;,&#39;cheetah&#39;,&#39;chimp&#39;));</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;$user-&gt;erase();</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;```</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;And the MongoDB equivalent would be:-</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;``` php</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;$user=new DB\Mongo\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;$user-&gt;load(array(&#39;userID&#39;=&gt;&#39;cheetah&#39;,&#39;password&#39;=&gt;&#39;chimp&#39;));</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;$user-&gt;erase();</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;```</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;### The Weather Report</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;To find out whether our data mapper was hydrated or not:-</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;``` php</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;if ($user-&gt;dry())</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    echo &#39;No record matching criteria&#39;;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;```</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;### Beyond CRUD</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;We&#39;ve covered the CRUD handlers. There are some extra methods that you might find useful:-</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;``` php</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;$f3-&gt;set(&#39;user&#39;,new DB\SQL\Mapper($db,&#39;users&#39;));</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;$f3-&gt;get(&#39;user&#39;)-&gt;copyFrom(&#39;POST&#39;);</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;$f3-&gt;get(&#39;user&#39;)-&gt;save();</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;```</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;Notice that we can also use Fat-Free variables as containers for mapper objects.</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;The `copyFrom()` method hydrates the mapper object with elements from a framework array variable, the array keys of which must have names identical to the mapper object properties, which in turn correspond to the record&#39;s field names. So, when a Web form is submitted (assuming the HTML name attribute is set to `userID`), the contents of that input field is transferred to `$_POST[&#39;userID&#39;]`, duplicated by F3 in its `POST.userID` variable, and saved to the mapped field `$user-&gt;userID` in the database. The process becomes very simple if they all have identically-named elements. Consistency in array keys, i.e. template token names, framework variable names and field names is key :)</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;On the other hand, if we wanted to retrieve a record and copy the field values to a framework variable for later use, like template rendering:-</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;``` php</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;$f3-&gt;set(&#39;user&#39;,new DB\SQL\Mapper($db,&#39;users&#39;));</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;$f3-&gt;get(&#39;user&#39;)-&gt;load(array(&#39;userID=?&#39;,&#39;jane&#39;));</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;$f3-&gt;get(&#39;user&#39;)-&gt;copyTo(&#39;POST&#39;);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;```</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;We can then assign {{ @POST.userID }} to the same input field&#39;s value attribute. To sum up, the HTML input field will look like this:-</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;``` html</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;&lt;input type=&quot;text&quot; name=&quot;userID&quot; value=&quot;{{ @POST.userID }}&quot;/&gt;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;```</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;The `save()`, `update()`, `copyFrom()` data mapper methods and the parameterized variants of `load()` and `erase()` are safe from SQL injection.</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;### Navigation and Pagination</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;By default, a data mapper&#39;s `load()` method retrieves only the first record that matches the specified criteria. If you have more than one that meets the same condition as the first record loaded, you can use the `skip()` method for navigation:-</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;``` php</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;$user=new DB\SQL\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;$user-&gt;load(&#39;visits&gt;3&#39;);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;// Rewritten as a parameterized query</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;$user-&gt;load(array(&#39;visits&gt;?&#39;,3));</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;// For MongoDB users:-</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;// $user=new DB\Mongo\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;// $user-&gt;load(array(&#39;visits&#39;=&gt;array(&#39;$gt&#39;=&gt;3)));</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;// If you prefer Jig:-</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;// $user=new DB\Jig\Mapper($db,&#39;users&#39;);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;// $user-&gt;load(&#39;@visits&gt;?&#39;,3);</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;// Display the userID of the first record that matches the criteria</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;echo $user-&gt;userID;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;// Go to the next record that matches the same criteria</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;$user-&gt;skip(); // Same as $user-&gt;skip(1);</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;// Back to the first record</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;$user-&gt;skip(-1);</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;// Move three records forward</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;$user-&gt;skip(3);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;```</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;You may use `$user-&gt;next()` as a substitute for `$user-&gt;skip()`, and `$user-&gt;prev()` if you think it gives more meaning to `$user-&gt;skip(-1)`.</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;Use the `dry()` method to check if you&#39;ve maneuvered beyond the limits of the result set. `dry()` will return TRUE if you try `skip(-1)` on the first record. It will also return TRUE if you `skip(1)` on the last record that meets the retrieval criteria.</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;The `load()` method accepts a second argument: an array of options containing key-value pairs such as:-</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;``` php</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;$user-&gt;load(</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    array(&#39;visits&gt;?&#39;,3),</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    array(</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        &#39;order&#39;=&gt;&#39;userID DESC&#39;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        &#39;offset&#39;=&gt;5,</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        &#39;limit&#39;=&gt;3</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    )</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;);</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;```</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;If you&#39;re using MySQL, the query translates to:-</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;``` mysql</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;SELECT * FROM users</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;WHERE visits&gt;3</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;ORDER BY userID DESC</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;LIMIT 3 OFFSET 5;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;```</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;This is one way of presenting data in small chunks. Here&#39;s another way of paginating results:-</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;``` php</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;$page=$user-&gt;paginate(2,5,array(&#39;visits&gt;?&#39;,3));</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;```</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;In the above scenario, F3 will retrieve records that match the criteria `&#39;visits&gt;3&#39;`. It will then limit the results to 5 records (per page) starting at page offset 2 (0-based). The framework will return an array consisting of the following elements:-</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;```</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;[subset] array of mapper objects that match the criteria</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;[count] number of subsets available</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;[pos] actual subset position</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;```</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;The actual subset position returned will be NULL if the first argument of `paginate()` is a negative number or exceeds the number of subsets found.</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;### Virtual Fields</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;There are instances when you need to retrieve a computed value of a field, or a cross-referenced value from another table. Enter virtual fields. The SQL mini-ORM allows you to work on data derived from existing fields.</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;Suppose we have the following table defined as:-</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;``` sql</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;CREATE TABLE products</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    productID VARCHAR(30),</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    description VARCHAR(255),</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    supplierID VARCHAR(30),</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    unitprice DECIMAL(10,2),</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    quantity INT,</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    PRIMARY KEY(productID)</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;```</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;No `totalprice` field exists, so we can tell the framework to request from the database engine the arithmetic product of the two fields:-</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;``` php</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;$item=new DB\SQL\Mapper($db,&#39;products&#39;);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;$item-&gt;totalprice=&#39;unitprice*quantity&#39;;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;$item-&gt;load(array(&#39;productID=:pid&#39;,&#39;:pid&#39;=&gt;&#39;apple&#39;));</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;echo $item-&gt;totalprice;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;```</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;The above code snippet defines a virtual field called `totalprice` which is computed by multiplying `unitprice` by the `quantity`. The SQL mapper saves that rule/formula, so when the time comes to retrieve the record from the database, we can use the virtual field like a regular mapped field.</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;You can have more complex virtual fields:-</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;``` php</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;$item-&gt;mostNumber=&#39;MAX(quantity)&#39;;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;$item-&gt;load();</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;echo $item-&gt;mostNumber;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;```</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;This time the framework retrieves the product with the highest quantity (notice the `load()` method does not define any criteria, so all records in the table will be processed). Of course, the virtual field `mostNumber` will still give you the right figure if you wish to limit the expression to a specific group of records that match a specified criteria.</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;You can also derive a value from another table:-</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;``` php</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;$item-&gt;supplierName=</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    &#39;SELECT name FROM suppliers &#39;.</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    &#39;WHERE products.supplierID=suppliers.supplierID&#39;;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;$item-&gt;load();</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;echo $item-&gt;supplierName;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;```</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;Every time you load a record from the products table, the ORM cross-references the `supplerID` in the `products` table with the `supplierID` in the `suppliers` table.</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;To destroy a virtual field, use `unset($item-&gt;totalPrice);`. The `isset($item-&gt;totalPrice)` expression returns TRUE if the `totalPrice` virtual field was defined, or FALSE if otherwise.</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;Remember that a virtual field must be defined prior to data retrieval. The ORM does not perform the actual computation, nor the derivation of results from another table. It is the database engine that does all the hard work.</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;### Seek and You Shall Find</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;If you have no need for record-by-record navigation, you can retrieve an entire batch of records in one shot:-</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;``` php</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;$frequentUsers=$user-&gt;find(array(&#39;visits&gt;?&#39;,3),array(&#39;order&#39;=&gt;&#39;userID&#39;));</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;```</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;Jig mapper&#39;s query syntax has a slight resemblance:-</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;``` php</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;$frequentUsers=$user-&gt;find(array(&#39;@visits&gt;?&#39;,3),array(&#39;order&#39;=&gt;&#39;userID&#39;));</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;```</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;The equivalent code using the MongoDB mapper:-</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;``` php</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;$frequentUsers=$user-&gt;find(array(&#39;visits&#39;=&gt;array(&#39;$gt&#39;=&gt;3)),array(&#39;userID&#39;=&gt;1));</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;```</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;The `find()` method searches the `users` table for records that match the criteria, sorts the result by `userID` and returns the result as an array of mapper objects. `find(&#39;visits&gt;3&#39;)` is different from `load(&#39;visits&gt;3&#39;)`. The latter refers to the current `$user` object. `find()` does not have any effect on `skip()`.</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;**Important:** Declaring an empty condition, NULL, or a zero-length string as the first argument of `find()` or `load()` will retrieve all records. Be sure you know what you&#39;re doing - you might exceed PHP&#39;s memory_limit on large tables or collections.</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;The `find()` method has the following syntax:-</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;``` php</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;find(</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    $criteria,</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    array(</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        &#39;group&#39;=&gt;&#39;foo&#39;,</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        &#39;order&#39;=&gt;&#39;foo,bar&#39;,</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        &#39;limit&#39;=&gt;5,</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        &#39;offset&#39;=&gt;0</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    )</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;);</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;```</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;find() returns an array of objects. Each object is a mapper to a record that matches the specified criteria.:-</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;``` php</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;$place=new DB\SQL\Mapper($db,&#39;places&#39;);</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;$list=$place-&gt;find(&#39;state=&quot;New York&quot;&#39;);</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;foreach ($list as $obj)</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    echo $obj-&gt;city.&#39;, &#39;.$obj-&gt;country;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;```</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;If you need to convert a mapper object to an associative array, use the `cast()` method:-</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;``` php</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;$array=$place-&gt;cast();</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;echo $array[&#39;city&#39;].&#39;, &#39;.$array[&#39;country&#39;];</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;```</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;To retrieve the number of records in a table that match a certain condition, use the `count()` method.</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;``` php</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;if (!$user-&gt;count(array(&#39;visits&gt;?&#39;,10)))</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    echo &#39;We need a better ad campaign!&#39;;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;```</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;There&#39;s also a `select()` method that&#39;s similar to `find()` but provides more fine-grained control over fields returned. It has a SQL-like syntax:-</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;``` php</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;select(</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    &#39;foo, bar, MIN(baz) AS lowest&#39;,</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    &#39;foo &gt; ?&#39;,</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    array(</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        &#39;group&#39;=&gt;&#39;foo, bar&#39;,</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        &#39;order&#39;=&gt;&#39;baz ASC&#39;,</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        &#39;limit&#39;=&gt;5,</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        &#39;offset&#39;=&gt;3</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    )</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;```</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;Much like the `find()` method, `select()` does not alter the mapper object&#39;s contents. It only serves as a convenience method for querying a mapped table. The return value of both methods is an array of mapper objects. Using `dry()` to determine whether a record was found by an of these methods is inappropriate. If no records match the `find()` or `select()` criteria, the return value is an empty array.</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;### Profiling</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;If you ever want to find out which SQL statements issued directly by your application (or indirectly thru mapper objects) are causing performance bottlenecks, you can do so with a simple:-</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;``` php</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;echo $db-&gt;log();</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;```</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;F3 keeps track of all commands issued to the underlying SQL database driver, as well as the time it takes for each statement to complete - just the right information you need to tweak application performance.</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;### Sometimes It Just Ain&#39;t Enough</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;In most cases, you can live by the comforts given by the data mapper methods we&#39;ve discussed so far. If you need the framework to do some heavy-duty work, you can extend the SQL mapper by declaring your own classes with custom methods - but you can&#39;t avoid getting your hands greasy on some hardcore SQL:-</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;``` php</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;class Vendor extends DB\SQL\Mapper {</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    // Instantiate mapper</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    function __construct(DB\SQL $db) {</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        // This is where the mapper and DB structure synchronization occurs</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        parent::__construct($db,&#39;vendors&#39;);</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    }</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    // Specialized query</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    function listByCity() {</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        return $this-&gt;select(</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            &#39;vendorID,name,city&#39;,array(&#39;order&#39;=&gt;&#39;city DESC&#39;));</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        /*</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;            We could have done the the same thing with plain vanilla SQL:-</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            return $this-&gt;db-&gt;exec(</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                &#39;SELECT vendorID,name,city FROM vendors &#39;.</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                &#39;ORDER BY city DESC;&#39;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;            );</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        */</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    }</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;}</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;$vendor=new Vendor;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;$vendor-&gt;listByCity();</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;```</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;Extending the data mappers in this fashion is an easy way to construct your application&#39;s DB-related models.</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;### Pros and Cons</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;If you&#39;re handy with SQL, you&#39;d probably say: everything in the ORM can be handled with old-school SQL queries. Indeed. We can do without the additional event listeners by using database triggers and stored procedures. We can accomplish relational queries with joined tables. The ORM is just unnecessary overhead. But the point is - data mappers give you the added functionality of using objects to represent database entities. As a developer, you can write code faster and be more productive. The resulting program will be cleaner, if not shorter. But you&#39;ll have to weigh the benefits against the compromise in speed - specially when handling large and complex data stores. Remember, all ORMS - no matter how thin they are - will always be just another abstraction layer. They still have to pass the work to the underlying SQL engines.</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;By design, F3&#39;s ORMs do not provide methods for directly connecting objects to each other, i.e. SQL joins - because this opens up a can of worms. It makes your application more complex than it should be, and there&#39;s the tendency of objects thru eager or lazy fetching techniques to be deadlocked and even out of sync due to object inheritance and polymorphism (impedance mismatch) with the database entities they&#39;re mapped to. There are indirect ways of doing it in the SQL mapper, using virtual fields - but you&#39;ll have to do this programmatically and at your own risk.</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;If you are tempted to apply &quot;pure&quot; OOP concepts in your application to represent all your data (because &quot;everything is an object&quot;), keep in mind that data almost always lives longer than the application. Your program may already be outdated long before the data has lost its value. Don&#39;t add another layer of complexity in your program by using intertwined objects and classes that deviate too much from the schema and physical structure of the data.</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;Before you weave multiple objects together in your application to manipulate the underlying tables in your database, think about this: creating views to represent relationships and triggers to define object behavior in the database engine are more efficient. Relational database engines are designed to handle views, joined tables and triggers. They are not dumb data stores. Tables joined in a view will appear as a single table, and Fat-Free can auto-map a view just as well as a regular table. Replicating JOINs as relational objects in PHP is slower compared to the database engine&#39;s machine code, relational algebra and optimization logic. Besides, joining tables repeatedly in our application is a sure sign that the database design needs to be audited, and views considered an integral part of data retrieval. If a table cross-references data from another table frequently, consider normalizing your structures or creating a view instead. Then create a mapper object to auto-map that view. It&#39;s faster and requires less effort.</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;Consider this SQL view created inside your database engine:-</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;``` sql</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;CREATE VIEW combined AS</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    SELECT</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        projects.project_id AS project,</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        users.name AS name</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    FROM projects</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    LEFT OUTER JOIN users ON</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        projects.project_id=users.project_id AND</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        projects.user_id=users.user_id;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;```</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;Your application code becomes simple because it does not have to maintain two mapper objects (one for the projects table and another for users) just to retrieve data from two joined tables:-</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;``` php</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;$combined=new DB\SQL\Mapper($db,&#39;combined&#39;);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;$combined-&gt;load(array(&#39;project=?&#39;,123));</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;echo $combined-&gt;name;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;```</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;Tip:Use the tools as they&#39;re designed for. Fat-Free already has an easy-to-use SQL helper. Use it if you need a bigger hammer :) Try to seek a balance between convenience and performance. SQL will always be your fallback if you&#39;re working on complex and legacy data structures.</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;## Plug-Ins</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;### About F3 Plug-ins</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;Plug-ins are nothing more than autoloaded classes that use framework built-ins to extend F3&#39;s features and functionality. If you&#39;d like to contribute, leave a note at the Fat-Free Discussion Area hosted by Google Groups or tell us about it in the FreeNode `#fatfree` IRC channel. Someone else might be involved in a similar project. The framework community will appreciate it a lot if we unify our efforts.</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;### CAPTCHA Images</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;There might be instances when you want to make your forms more secure against spam bots and malicious automated scripts. F3 provides a `captcha()` method to generate images with random text that are designed to be recognizable only by humans.</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;``` php</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;$img = new Image();</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;$img-&gt;captcha(&#39;fonts/CoolFont.ttf&#39;,16,5,&#39;SESSION.captcha_code&#39;);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;$img-&gt;render();</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;```</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;This example generates an random image based on your desired TrueType font. The `fonts/` folder is a subfolder within application&#39;s `UI` path. The second parameter indicates the font size, and the third argument defines the number of hexadecimal characters to generate.</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;The last argument represents an F3 variable name. This is where F3 will store the string equivalent of the CAPTCHA image. To make the string reload-safe, we specified a session variable:- `SESSION.captcha_code` which maps to `$_SESSION[&#39;captcha_code&#39;]`, which you can use later to verify whether the input element in the form submitted matches this string.</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;### Grabbing Data from Another Site</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;We&#39;ve covered almost every feature available in the framework to run a stand-alone Web server. For most applications, these features will serve you quite well. But what do you do if your application needs data from another Web server on the network? F3 has the Web plugin to help you in this situation:-</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;``` php</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;$web=new Web;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;$request=$web-&gt;request(&#39;http://www.google.com/&#39;);</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;// another way to do it:-</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;$request=Web::instance()-&gt;request(&#39;http://www.google.com/&#39;);</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;```</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;This simple example sends an HTTP request to the page located at www.google.com and stores it in the `$request` PHP variable. The `request()` method returns an array containing the HTTP response such that `$request[&#39;headers&#39;]` and `$request[&#39;body&#39;]` represent the response headers and body, respectively. We could have saved the contents using the F3::set command, or echo&#39;ed the output directly to our browser. Retrieving another HTML page on the net may not have any practical purpose. But it can be particularly useful in ReSTful applications, like querying a CouchDB server.</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;``` php</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;$host=&#39;localhost:5984&#39;;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;$web-&gt;request($host.&#39;/_all_dbs&#39;),</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;$web-&gt;request($host.&#39;/testdb/&#39;,array(&#39;method&#39;=&gt;&#39;PUT&#39;));</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;```</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;You may have noticed that you can pass an array of additional options to the `request()` method:-</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;``` php</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;$web-&gt;request(</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    &#39;https://www.example.com:443?&#39;.</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    http_build_query(</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        array(</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;            &#39;key1&#39;=&gt;&#39;value1&#39;,</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;            &#39;key2&#39;=&gt;&#39;value2&#39;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        )</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    ),</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    array(</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        &#39;headers&#39;=&gt;array(</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            &#39;Accept: text/html,application/xhtml+xml,application/xml&#39;,</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;            &#39;Accept-Language: en-us&#39;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        ),</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        &#39;follow_location&#39;=&gt;FALSE,</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        &#39;max_redirects&#39;=&gt;30,</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        &#39;ignore_errors&#39;=&gt;TRUE</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    )</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;);</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;```</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;If the framework variable `CACHE` is enabled, and if the remote server instructs your application to cache the response to the HTTP request, F3 will comply with the request and retrieve the cached response each time the framework receives a similar request from your application, thus behaving like a browser.</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;Fat-Free will use whatever means are available on your Web server for the `request()` method to run: PHP stream wrappers (`allow_url_fopen`), cURL module, or low-level sockets.</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;### Handling File Downloads</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;F3 has a utility for sending files to an HTTP client, i.e. fulfilling download requests. You can use it to hide the real path to your download files. This adds some layer of security because users won&#39;t be able to download files if they don&#39;t know the file names and their locations. Here&#39;s how it&#39;s done:-</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;``` php</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;$f3-&gt;route(&#39;GET /downloads/@filename&#39;,</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    function($f3,$args) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        // send() method returns FALSE if file doesn&#39;t exist</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        if (!Web::instance()-&gt;send(&#39;/real/path/&#39;.$args[&#39;filename&#39;]))</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            // Generate an HTTP 404</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        $f3-&gt;error(404);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;);</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;```</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;### Remoting and Distributed Applications</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;The `request()` method can also be used in complex SOAP or XML-RPC applications, if you find the need for another Web server to process data on your computer&#39;s behalf - thus harnessing the power of distributing computing. W3Schools.com has an excellent tutorial on SOAP. On the other hand, TutorialsPoint.com gives a nice overview of XML-RPC.</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;## Optimization</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;### Cache Engine</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;Caching static Web pages - so the code in some route handlers can be skipped and templates don&#39;t have to be reprocessed - is one way of reducing your Web server&#39;s work load so it can focus on other tasks. You can activate the framework&#39;s cache engine by providing a third argument to the `$f3-&gt;route()` method. Just specify the number of seconds before a cached Web page expires:-</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;``` php</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;$f3-&gt;route(&#39;GET /my_page&#39;,&#39;App-&gt;method&#39;,60);</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;```</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;Here&#39;s how it works. In this example, when F3 detects that the URL `/my_page` is accessed for the first time, it executes the route handler represented by the second argument and saves all browser output to the framework&#39;s built-in cache (server-side). A similar instruction is automatically sent to the user&#39;s Web browser (client-side), so that instead of sending an identical request to the server within the 60-second period, the browser can just retrieve the page locally. The framework uses the cache for an entirely different purpose - serving framework-cached data to other users asking for the same Web page within the 60-second time frame. It skips execution of the route handler and serves the previously-saved page directly from disk. When someone tries to access the same URL after the 60-second timer has lapsed, F3 will refresh the cache with a new copy.</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;Web pages with static data are the most likely candidates for caching. Fat-Free will not cache a Web page at a specified URL if the third argument in the `$f3-&gt;route()` method is zero or unspecified. F3 conforms to the HTTP specifications: only GET and HEAD requests can be cached.</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;Here&#39;s an important point to consider when designing your application. Don&#39;t cache Web pages unless you understand the possible unwanted side-effects of the cache at the client-side. Make sure that you activate caching on Web pages that have nothing to do with the user&#39;s session state.</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;For example, you designed your site in such a way that all your Web pages have the menu options: `&quot;Home&quot;`, `&quot;About Us&quot;`, and `&quot;Login&quot;`, displayed when a user is not logged into your application. You also want the menu options to change to: `&quot;Home&quot;`, `&quot;About Us&quot;`, and `&quot;Logout&quot;`, once the user has logged in. If you instructed Fat-Free to cache the contents of `&quot;About Us&quot;` page (which includes the menu options), it does so and also sends the same instruction to the HTTP client. Regardless of the user&#39;s session state, i.e. logged in or logged out, the user&#39;s browser will take a snapshot of the page at the session state it was in. Future requests by the user for the `&quot;About Us&quot;` page before the cache timeout expires will display the same menu options available at that time the page was initially saved. Now, a user may have already logged in, but the menu options are still the same as if no such event occurred. That&#39;s not the kind of behavior we want from our application.</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;Some pointers:-</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;* Don&#39;t cache dynamic pages. It&#39;s quite obvious you don&#39;t want to cache data that changes frequently. You can, however, activate caching on pages that contain data updated on an hourly, daily or even yearly basis.For security reasons, the framework restricts cache engine usage to HTTP `GET` routes only. It will not cache submitted forms!Don&#39;t activate the cache on Web pages that at first glance look static. In our example, the &quot;About Us&quot; content may be static, but the menu isn&#39;t.</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;* Activate caching on pages that are available only in ONE session state. If you want to cache the `&quot;About Us&quot;` page, make sure it&#39;s available only when a user is not logged in.</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;* If you have a RAMdisk or fast solid-state drive, configure the `CACHE` global variable so it points to that drive. This will make your application run like a Formula 1 race car.</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;**Note:** Don&#39;t set the timeout value to a very long period until you&#39;re ready to roll out your application, i.e. the release or production state. Changes you make to any of your PHP scripts may not have the expected effect on the displayed output if the page exists in the framework cache and the expiration period has not lapsed. If you do alter a program that generates a page affected by the cache timer and you want these changes to take effect immediately, you should clear the cache by erasing the files in the cache/ directory (or whatever path the `CACHE` global variable points to). F3 will automatically refresh the cache if necessary. At the client-side, there&#39;s little you can do but instruct the user to clear the browser&#39;s cache or wait for the cache period to expire.</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;PHP needs to be set up correctly for the F3 cache engine to work properly. Your operating system timezone should be synchronized with the date.timezone setting in the `php.ini` file.</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;Similar to routes, Fat-Free also allows you to cache database queries. Speed gains can be quite significant, specially when used on complex SQL statements that involve look-up of static data or database content that rarely changes. Activating the database query cache so the framework doesn&#39;t have to re-execute the SQL statements every time is as simple as adding a 3rd argument to the F3::sql command - the cache timeout. For example:-</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;``` php</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;$db-&gt;exec(&#39;SELECT * from sizes;&#39;,NULL,86400);</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;```</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;If we expect the result of this database query to always be `Small`, `Medium`, and `Large` within a 24-hour period, we specify `86400` seconds as the 2nd argument so Fat-Free doesn&#39;t have to execute the query more than once a day. Instead, the framework will store the result in the cache, retrieve it from the cache every time a request comes in during the specified 24-hour time frame, and re-execute the query when the timer lapses.</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;The SQL data mapper also uses the cache engine to optimize synchronization of table structures with the objects that represent them. The default is `60` seconds. If you make any changes to a table&#39;s structure in your database engine, you&#39;ll have to wait for the cache timer to expire before seeing the effect in your application. You can change this behavior by specifying a third argument to the data mapper constructor. Set it to a high value if you don&#39;t expect to make any further changes to your table structure.</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;``` php</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;$user=new DB\SQL\Mapper($db,&#39;users&#39;,86400);</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;```</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;By default, Fat-Free&#39;s cache engine is disabled. You can enable it and allow it to auto-detect APC, WinCache or XCache. If it cannot find an appropriate backend, F3 will use the filesystem, i.e. the `tmp/cache/` folder:-</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;``` php</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;$f3-&gt;set(&#39;CACHE&#39;,TRUE);</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;```</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;Disabling the cache is as simple as:-</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;``` php</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;$f3-&gt;set(&#39;CACHE&#39;,FALSE);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;```</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;If you wish to override the auto-detection feature, you can do so - as in the case of a Memcached back-end which F3 also supports:-</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;``` php</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;$f3-&gt;set(&#39;CACHE&#39;,&#39;memcache=localhost:11211&#39;);</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;```</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;You can also use the cache engine to store your own variables. These variables will persist between HTTP requests and remain in cache until the engine receives instructions to delete them. To save a value in the cache:-</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;``` php</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;$f3-&gt;set(&#39;var&#39;,&#39;I want this value saved&#39;,90);</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;```</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;`$f3-&gt;set()` method&#39;s third argument instructs the framework to save the variable in the cache for a 90-second duration. If your application issues a `$f3-&gt;get(&#39;var&#39;)` within this period, F3 will automatically retrieve the value from cache. In like manner, `$f3-&gt;clear(&#39;var&#39;)` will purge the value from both cache and RAM. If you want to determine if a variable exists in cache, `$f3-&gt;exists(&#39;var&#39;)); returns one of two possible values: FALSE if the framework variable passed does not exist in cache, or an integer representing the time the variable was saved (Un*x time in seconds, with microsecond precision).</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;### Keeping Javascript and CSS on a Healthy Diet</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;Fat-Free also has a Javascript and CSS compressor available in the Web plug-in. It can combine all your CSS files into one stylesheet (or Javascript files into a single script) so the number of components on a Web page are decreased. Reducing the number of HTTP requests to your Web server results in faster page loading. First you need to prepare your HTML template so it can take advantage of this feature. Something like:-</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;``` html</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;   href=&quot;/minify/css?files=typo.css,grid.css&quot; /&gt;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;```</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;Do the same with your Javascript files:-</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;``` html</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;&lt;script type=&quot;text/javascript&quot; src=&quot;/minify/js?&amp;files=underscore.js&quot;&gt;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;&lt;/script&gt;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;```</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;Of course we need to set up a route so your application can handle the necessary call to the Fat-Free CSS/Javascript compressor:-</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;``` php</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;$f3-&gt;route(&#39;GET /minify/@type&#39;,</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    function($f3,$args) {</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        $f3-&gt;set(&#39;UI&#39;,$args[&#39;type&#39;].&#39;/&#39;);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        echo Web::instance()-&gt;minify($_GET[&#39;files&#39;]);</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    },</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    3600</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;);</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;```</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;And that&#39;s all there is to it! `minify()` reads each file (`typo.css` and `grid.css` in our CSS example, `underscore.js` in our Javascript example), strips off all unnecessary whitespaces and comments, combines all of the related items as a single Web page component, and attaches a far-future expiry date so the user&#39;s Web browser can cache the data. It&#39;s important that the `PARAMS.type` variable base points to the correct path. Otherwise, the URL rewriting mechanism inside the compressor won&#39;t find the CSS/Javascript files.</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;### Client-Side Caching</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;In our examples, the framework sends a far-future expiry date to the client&#39;s Web browser so any request for the same CSS or Javascript block will come from the user&#39;s hard drive. On the server side, F3 will check each request and see if the CSS or Javascript blocks have already been cached. The route we specified has a cache refresh period of `3600` seconds. Additionally, if the Web browser sends an `If-Modified-Since` request header and the framework sees the cache hasn&#39;t changed, F3 just sends an `HTTP 304 Not Modified` response so no content is actually delivered. Without the `If-Modified-Since` header, Fat-Free renders the output from the cached file if available. Otherwise, the relevant code is executed.</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;Tip: If you&#39;re not modifying your Javascript/CSS files frequently (as it would be if you&#39;re using a Javascript library like jQuery, MooTools, Dojo, etc.), consider adding a cache timer to the route leading to your Javascript/CSS minify handler (3rd argument of F3::route()) so Fat-Free doesn&#39;t have compress and combine these files each time such a request is received.</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;### PHP Code Acceleration</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;Want to make your site run even faster? Fat-Free works best with either Alternative PHP Cache (APC), XCache, or WinCache. These PHP extensions boost performance of your application by optimizing your PHP scripts (including the framework code).</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;### Bandwidth Throttling</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;A fast application that processes all HTTP requests and responds to them at the shortest time possible is not always a good idea - specially if your bandwidth is limited or traffic on your Web site is particularly heavy. Serving pages ASAP also makes your application vulnerable to Denial-of-Service (DOS) attacks. F3 has a bandwidth throttling feature that allows you to control how fast your Web pages are served. You can specify how much time it should take to process a request:-</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;``` php</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;$f3-&gt;route(&#39;/throttledpage&#39;,&#39;MyApp-&gt;handler&#39;,0,128);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;```</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;In this example, the framework will serve the Web page at a rate of 128KiBps.</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;Bandwidth throttling at the application level can be particularly useful for login pages. Slow responses to dictionary attacks is a good way of mitigating this kind of security risk.</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;## Unit Testing</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;### Bullet-Proof Code</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;Robust applications are the result of comprehensive testing. Verifying that each part of your program conforms to the specifications and lives up to the expectations of the end-user means finding bugs and fixing them as early as possible in the application development cycle.</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;If you know little or nothing about unit testing methodologies, you&#39;re probably embedding pieces of code directly in your existing program to help you with debugging. That of course means you have to remove them once the program is running. Leftover code fragments, poor design and faulty implementation can creep up as bugs when you roll out your application later.</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;F3 makes it easy for you to debug programs - without getting in the way of your regular thought processes. The framework does not require you to build complex OOP classes, heavy test structures, and obtrusive procedures.</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;A unit (or test fixture) can be a function/method or a class. Let&#39;s have a simple example:-</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;``` php</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;function hello() {</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    return &#39;Hello, World&#39;;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;}</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;```</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;Save it in a file called `hello.php`. Now how do we know it really runs as expected? Let&#39;s create our test procedure:-</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;``` php</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;$f3=require(&#39;lib/base.php&#39;);</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;// Set up</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;$test=new Test;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;include(&#39;hello.php&#39;);</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;// This is where the tests begin</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;$test-&gt;expect(</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    is_callable(&#39;hello&#39;),</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    &#39;hello() is a function&#39;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;);</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;// Another test</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;$hello=hello();</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;$test-&gt;expect(</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    !empty($hello),</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    &#39;Something was returned&#39;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;);</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;// This test should succeed</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;$test-&gt;expect</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    is_string($hello),</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    &#39;Return value is a string&#39;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;);</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;// This test is bound to fail</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;$test-&gt;expect(</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    strlen($hello)==13,</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    &#39;String length is 13&#39;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;);</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;// Display the results; not MVC but let&#39;s keep it simple</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;foreach ($test-&gt;results() as $result) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    echo $result[&#39;text&#39;].&#39;&lt;br /&gt;&#39;;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    if ($result[&#39;status&#39;])</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        echo &#39;Pass&#39;;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    else</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        echo &#39;Fail (&#39;.$result[&#39;source&#39;].&#39;)&#39;;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    echo &#39;&lt;br /&gt;&#39;;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;}</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;```</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;Save it in a file called `test.php`. This way we can preserve the integrity of `hello.php`.</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;Now here&#39;s the meat of our unit testing process.</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;F3&#39;s built-in `Test` class keeps track of the result of each `expect()` call. The output of `$test-&gt;results()` is an array of arrays with the keys `text` (mirroring argument 2 of `expect()`), `status` (boolean representing the result of a test), and `source` (file name/line number of the specific test) to aid in debugging.</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;Fat-Free gives you the freedom to display test results in any way you want. You can have the output in plain text or even a nice-looking HTML template. So how do we run our unit test? If you saved `test.php` in the document root folder, you can just open your browser and specify the address `http://localhost/test.php`. That&#39;s all there is to it.</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;### Mocking HTTP Requests</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;F3 gives you the ability to simulate HTTP requests from within your PHP program so you can test the behavior of a particular route. Here&#39;s a simple mock request:-</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;``` php</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;$f3-&gt;mock(&#39;GET /test?foo=bar&#39;);</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;```</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;To mock a POST request and submit a simulated HTML form:-</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;``` php</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;$f3-&gt;mock(&#39;POST /test&#39;,array(&#39;foo&#39;=&gt;&#39;bar&#39;));</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;```</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;### Expecting the Worst that can Happen</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;Once you get the hang of testing the smallest units of your application, you can then move on to the bigger components, modules, and subsystems - checking along the way if the parts are correctly communicating with each other. Testing manageable chunks of code leads to more reliable programs that work as you expect, and weaves the testing process into the fabric of your development cycle. The question to ask yourself is:- Have I tested all possible scenarios? More often than not, those situations that have not been taken into consideration are the likely causes of bugs. Unit testing helps a lot in minimizing these occurrences. Even a few tests on each fixture can greatly reduce headaches. On the other hand, writing applications without unit testing at all invites trouble.</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;## Quick Reference</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;### System Variables</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;`string AGENT`</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;* Auto-detected HTTP user agent, e.g. `Mozilla/5.0 (Linux; Android 4.2.2; Nexus 7) AppleWebKit/537.31`.</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;`bool AJAX`</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;* `TRUE` if an XML HTTP request is detected, `FALSE` otherwise.</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;`string AUTOLOAD`</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;* Search path for user-defined PHP classes that the framework will attempt to autoload at runtime. Accepts a pipe (`|`), comma (`,`), or semi-colon (`;`) as path separator.</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;`string BASE`</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;* Path to the `index.php` main/front controller.</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;`string BODY`</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;* HTTP request body for ReSTful post-processing.</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;`bool/string CACHE`</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;* Cache backend. Unless assigned a value like `&#39;memcache=localhost&#39;` (and the PHP memcache module is present), F3 auto-detects the presence of APC, WinCache and XCache and uses the first available PHP module if set to TRUE. If none of these PHP modules are available, a filesystem-based backend is used (default directory: `tmp/cache`). The framework disables the cache engine if assigned a `FALSE` value.</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;`bool CASELESS`</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;* Pattern matching of routes against incoming URIs is case-insensitive by default. Set to `FALSE` to make it case-sensitive.</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;`array COOKIE, GET, POST, REQUEST, SESSION, FILES, SERVER, ENV`</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;* Framework equivalents of PHP globals. Variables may be used throughout an application. However, direct use in templates is not advised due to security risks.</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;`integer DEBUG`</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;* Stack trace verbosity. Assign values 1 to 3 for increasing verbosity levels. Zero (0) suppresses the stack trace. This is the default value and it should be the assigned setting on a production server.</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;`string DNSBL`</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;* Comma-separated list of [DNS blacklist servers](http://whatismyipaddress.com/blacklist-check). Framework generates a `403 Forbidden` error if the user&#39;s IPv4 address is listed on the specified server(s).</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;`array DIACRITICS`</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;* Key-value pairs for foreign-to-ASCII character translations.</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;`string ENCODING`</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;* Character set used for document encoding. Default value is `UTF-8`.</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;`array ERROR`</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;* Information about the last HTTP error that occurred. `ERROR.code` is the HTTP status code. `ERROR.status` contains a brief description of the error. `ERROR.text` provides more detail. For HTTP 500 errors, use `ERROR.trace` to retrieve the stack trace.</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;`bool ESCAPE`</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;* Used to enable/disable auto-escaping.</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;`string EXEMPT`</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;* Comma-separated list of IPv4 addresses exempt from DNSBL lookups.</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;`string FALLBACK`</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;* Language (and dictionary) to use if no translation is available.</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;`bool HALT`</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;* If TRUE (default), framework stops execution after a non-fatal error is detected.</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;`array HEADERS`</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;* HTTP request headers received by the server.</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;`bool HIGHLIGHT`</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;* Enable/disable syntax highlighting of stack traces. Default value: `TRUE` (requires `code.css` stylesheet).</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;`string HOST`</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;* Server host name. If `$_SERVER[&#39;SERVER_NAME&#39;]` is not available, return value of `gethostname()` is used.</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;`string IP`</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;* Remote IP address. The framework derives the address from headers if HTTP client is behind a proxy server.</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;`array JAR`</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;* Default cookie parameters.</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;`string LANGUAGE`</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;* Current active language. Value is used to load the appropriate language translation file in the folder pointed to by `LOCALES`. If set to `NULL`, language is auto-detected from the HTTP `Accept-Language` request header.</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;`string LOCALES`</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;* Location of the language dictionaries.</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;`string LOGS`</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;* Location of custom logs.</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;`mixed ONERROR`</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;* Callback function to use as custom error handler.</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;`string PACKAGE`</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;* Framework name.</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;`array PARAMS`</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;* Captured values of tokens defined in a `route()` pattern. `PARAMS.0` contains the captured URL relative to the Web root.</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;`string PATTERN`</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;* Contains the routing pattern that matches the current request URI.</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;`string PLUGINS`</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;* Location of F3 plugins. Default value is the folder where the framework code resides, i.e. the path to `base.php`.</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;`int PORT`</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;* TCP/IP listening port used by the Web server.</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;`string PREFIX`</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;* String prepended to language dictionary terms.</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;`bool QUIET`</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;* Toggle switch for suppressing or enabling standard output and error messages. Particularly useful in unit testing.</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;`bool RAW`</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;* Disable automatic storage of HTTP request body into `BODY`. Should be TRUE when processing large data coming from `php://input` which will not fit in memory. Default value: `FALSE`</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;`string REALM`</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;* Full canonical URL.</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;`string RESPONSE`</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;* The body of the last HTTP response. F3 populates this variable regardless of the `QUIET` setting.</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;`string ROOT`</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;* Absolute path to document root folder.</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;`array ROUTES`</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;* Contains the defined application routes.</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;`string SCHEME`</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;* Server protocol, i.e. `http` or `https`.</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;`string SERIALIZER`</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;* Default serializer. Normally set to `php`, unless PHP `igbinary` extension is auto-detected. Assign `json` if desired.</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;`string TEMP`</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;* Temporary folder for cache, filesystem locks, compiled F3 templates, etc. Default is the `tmp/` folder inside the Web root. Adjust accordingly to conform to your site&#39;s security policies.</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;`string TZ`</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;* Default timezone. Changing this value automatically calls the underlying `date_default_timezone_set()` function.</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;`string UI`</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;* Search path for user interface files used by the `View` and `Template` classes&#39; `render()` method. Default value is the Web root. Accepts a pipe (`|`), comma (`,`), or semi-colon (`;`) as separator for multiple paths.</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;`callback UNLOAD`</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;* Executed by framework on script shutdown.</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;`string UPLOADS`</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;* Directory where file uploads are saved.</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;`string URI`</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;* Current HTTP request URI.</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;`string VERB`</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;* Current HTTP request method.</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;`string VERSION`</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;* Framework version.</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;### Template Directives</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;```</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;@token</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;```</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;* Replace `@token` with value of equivalent F3 variable.</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;```</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;{{ mixed expr }}</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;```</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;* Evaluate. `expr` may include template tokens, constants, operators (unary, arithmetic, ternary and relational), parentheses, data type converters, and functions. If not an attribute of a template directive, result is echoed.</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;```</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;{{ string expr | raw }}</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;```</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;* Render unescaped `expr`. F3 auto-escapes strings by default.</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;```</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;{{ string expr | esc }}</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;```</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;* Render escaped `expr`. This is the default framework behavior. The `| esc` suffix is only necessary if `ESCAPE` global variable is set to `FALSE`.</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;```</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;{{ string expr, arg1, ..., argN | format }}</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;```</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;* Render an ICU-formatted `expr` and pass the comma-separated arguments, where `arg1, ..., argn` is one of:- `&#39;date&#39;`, `&#39;time&#39;`, `&#39;number, integer&#39;`, `&#39;number, currency&#39;`, or `&#39;number, percent&#39;`.</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;```</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;&lt;include</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    [ if=&quot;{{ bool condition }}&quot; ]</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    href=&quot;{{ string subtemplate }}&quot;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;/&gt;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;```</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;* Get contents of `subtemplate` and insert at current position in template if optional condition is `TRUE`.</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;```</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;&lt;exclude&gt;text-block&lt;/exclude&gt;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;```</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;* Remove `text-block` at runtime. Used for embedding comments in templates.</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;```</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;&lt;ignore&gt;text-block&lt;/ignore&gt;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;```</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;* Display `text-block` as-is, without interpretation/modification by the template engine.</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;```</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;&lt;check if=&quot;{{ bool condition }}&quot;&gt;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    &lt;true&gt;true-block&lt;/true&gt;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    &lt;false&gt;false-block&lt;/false&gt;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;&lt;/check&gt;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;```</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;* Evaluate condition. If `TRUE`, then `true-block` is rendered. Otherwise, `false-block` is used.</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;```</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;&lt;loop</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    from=&quot;{{ statement }}&quot;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    to=&quot;{{ bool expr }}&quot;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    [ step=&quot;{{ statement }}&quot; ]&gt;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    text-block</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;&lt;/loop&gt;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;```</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;* Evaluate `from` statement once. Check if the expression in the `to` attribute is `TRUE`, render `text-block` and evaluate `step` statement. Repeat iteration until `to` expression is `FALSE`.</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;```</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;&lt;repeat</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    group=&quot;{{ array @group|expr }}&quot;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    [ key=&quot;{{ scalar @key }}&quot; ]</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    value=&quot;{{ mixed @value }}</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    [ counter=&quot;{{ scalar @key }}&quot; ]&gt;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    text-block</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;&lt;/repeat&gt;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;```</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;* Repeat `text-block` as many times as there are elements in the array variable `@group` or the expression `expr`. `@key` and `@value` function in the same manner as the key-value pair in the equivalent PHP `foreach()` statement. Variable represented by `key` in `counter` attribute increments by `1` with every iteration.</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;```</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;&lt;switch expr=&quot;{{ scalar expr }}&quot;&gt;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    &lt;case value=&quot;{{ scalar @value|expr }}&quot; break=&quot;{{ bool TRUE|FALSE }}&quot;&gt;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        text-block</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    &lt;/case&gt;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    .</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    .</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    .</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;&lt;/switch&gt;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;```</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;* Equivalent of the PHP switch-case jump table structure.</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;```</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;{* text-block *}</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;```</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;* Alias for `&lt;exclude&gt;`.</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;### API Documentation</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;The most up-to-date documentation is located at [http://fatfreeframework.com/](http://fatfreeframework.com/). It contains examples of usage of the various framework components.</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;## Support and Licensing</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;Technical support is available at the official discussion forum: [`https://groups.google.com/forum/#!forum/f3-framework`](https://groups.google.com/forum/#!forum/f3-framework). If you need live support, you can talk to the development team and other members of the F3 community via IRC. We&#39;re on the FreeNode `#fatfree` channel (`chat.freenode.net`). Visit [`http://webchat.freenode.net/`](http://webchat.freenode.net/) to join the conversation. You can also download the [Firefox Chatzilla](https://addons.mozilla.org/en-US/firefox/addon/chatzilla/) add-on or [Pidgin](http://www.pidgin.im/) if you don&#39;t have an IRC client so you can participate in the live chat.</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;### Nightly Builds</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;F3 uses Git for version control. To clone the code repository on GitHub:-</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;``` bash</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;git clone git://github.com/bcosca/fatfree.git</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;```</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;If all you want is a zipball, grab it [**here**](https://github.com/bcosca/fatfree/archive/dev.zip).</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;To file a bug report, visit [`https://github.com/bcosca/fatfree/issues`](https://github.com/bcosca/fatfree/issues).</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;### Fair Licensing</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;**Fat-Free Framework is free and released as open source software covered by the terms of the [GNU Public License](http://www.gnu.org/licenses/gpl-3.0.html) (GPL v3).** You may not use the software, documentation, and samples except in compliance with the license. If the terms and conditions of this license are too restrictive for your use, alternative licensing is available for a very reasonable fee.</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;If you feel that this software is one great weapon to have in your programming arsenal, it saves you a lot of time and money, use it for commercial gain or in your business organization, please consider making a donation to the project. A significant amount of time, effort, and money has been spent on this project. Your donations help keep this project alive and the development team motivated. Donors and sponsors get priority support (24-hour response time on business days).</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;### Credits</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;The Fat-Free Framework is community-driven software. It can&#39;t be what it is today without the help and support from the following people and organizations:</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;* GitHub</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;* Square Lines, LLC</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;* Mirosystems</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;* Stehlik &amp; Company</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;* Talis Group, Ltd.</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;* Tecnil√≥gica</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;* G Holdings, LLC</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;* S2 Development, Ltd.</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;* Store Machine</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;* PHP Experts, Inc.</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;* Meins und Vogel GmbH</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;* Online Prepaid Services</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;* Christian Knuth</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;* Sascha Ohms</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;* Lars Brandi Jensen</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;* Jermaine Maree</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;* Ey√∞un Lamhauge</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;* Sergey Zaretsky</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;* Daniel Kloke</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;* Brian Nelson</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;* Roberts Lapins</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;* Boris Gurevich</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;* Jose Maria Garrido Diaz</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;* Dawn Comfort</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;* Johan Viberg</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;* Povilas Musteikis</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;* Andrew Snook</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;* Jafar Amjad</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;* Taylor McCall</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;* Raymond Kirkland</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;* Yuriy Gerassimenko</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;* William Stam</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;* Sam George</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;* Steve Wasiura</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;* Andreas Ljunggren</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;* Sashank Tadepalli</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;* Chad Bishop</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;* Bradley Slavik</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;* Lee Blue</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;* Alexander Shatilo</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;* Justin Noel</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;* Ivan Kovac</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;* Tony&#39;s Internet Solutions</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;* Charles Stigler</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;* Attila van der Velde</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;* Indoblo Commerce Ltd.</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;* Jens N√≠emeyer</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;* Raghu Veer Dendukuri</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;* NovelLead B.V.</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;* Emir Alp</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;* Dominic Schwarz</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;* Sven Zahrend</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;* LucidStorm</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;* Nevatech</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;* Matt Wielgos</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;* Maximilian Summe</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;* Caspar Frey</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;* FocusHeart</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;* Philip Lawrence</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;* Peter Beverwyk</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;* Judith Grass</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;* Randal Hintz</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;* Franz Josef</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;* Biswajit Nayak</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;* R Mohan</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;* Michael Messner</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;* Florent Racineux</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;* Jason Borseth</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;* Dmitrij Chernov</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;* Marek Toman</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;* Simone Cociancich</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;* Alan Holding</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;* Philipp Hirsch</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;* Aur√©lien Botermans</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;* Christian Treptow</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;* –ö—É–±–∞—Ä–µ–≤ –î–º–∏—Ç—Ä–∏–π (Dmitry Kubarev)</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;* Alexandru Catalin Trandafir</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;* Leigh Harrison</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;* –î–º–∏—Ç—Ä–∏–µ–≤ –ò–≤–∞–Ω (Ivan Dmitriev)</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;* IT_GAP</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;* Sergeev Andrey</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;* Steven J Mixon</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;* Roland Fath</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;* Justin Parker</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;* Costas Menico</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;* Mathieu-Philippe Bourgeois</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;* Ryan McKillop</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;* Chris Clarke</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;* Ngan Ting On</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;* Eli Argon</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;* Seregin Andrew</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;* Marek Toman</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;* Diji Enterprises</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;* uonick</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;* Kamil Kiblis</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;* Mars Yau</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;* Martin Latinov</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;* Malikov Evgene</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;* Andres Espinoza Arce</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;* Matthew Williamson</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;* Andrew Brookes</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;* Steve Cove</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;* Steven Witten</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;* Silvan Seeholzer</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;Special thanks to the selfless others who expressed their desire to remain anonymous, yet share their time, contribute code, send donations, promote the framework to a wider audience, as well as provide encouragement and regular financial assistance. Their generosity is F3&#39;s prime motivation.</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;[![Paypal](ui/images/paypal.png)](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=MJSQL8N5LPDAY)</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;![Bitcoin](ui/images/bitcoin.png)</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;### Legal notice</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;By making a donation to this project you signify that you acknowledged, understood, accepted, and agreed to the terms and conditions contained in this notice. Your donation to the Fat-Free Framework project is voluntary and is not a fee for any services, goods, or advantages, and making a donation to the project does not entitle you to any services, goods, or advantages. We have the right to use the money you donate to the Fat-Free Framework project in any lawful way and for any lawful purpose we see fit and we are not obligated to disclose the way and purpose to any party unless required by applicable law. Although Fat-Free Framework is free software, to our best knowledge this project does not have any tax-exempt status. The Fat-Free Framework project is neither a registered non-profit corporation nor a registered charity in any country. Your donation may or may not be tax-deductible; please consult this with your tax advisor. We will not publish/disclose your name and e-mail address without your consent, unless required by applicable law. Your donation is non-refundable.</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;**Copyright (c) 2009-2014 F3::Factory/Bong Cosca &amp;lt;bong&amp;#46;cosca&amp;#64;yahoo&amp;#46;com&amp;gt;**</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;[![githalytics.com alpha](https://cruel-carlota.pagodabox.com/a0b5e3f40092429070b6647a2e5ca6ab &quot;githalytics.com&quot;)](http://githalytics.com/bcosca/fatfree)</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
